_jsload2&&_jsload2('clayer', 'w.extend(kb.prototype,{Uk:{},Aj:[],uu:"",Yp:"",gG:"",Vk:p,Gg:p,Fg:p,Eg:[],fG:0,Qy:s(),My:s(),nu:s(),Md:function(){this.oG()},pa:function(a,b){Ec.prototype.pa.call(this,a,b);this.Uk={};this.Aj=[];this.B=a;this.oG()},ct:ca(o),remove:function(){Ec.prototype.remove.call(this);this.pT()},oG:function(){var a=this,b=a.B;b&&(this.Qy=function(b){a.IS(b)},this.My=function(b){a.iS(b)},this.nu=function(b){a.hS(b)},b.addEventListener("mousemove",this.Qy),b.addEventListener("onhotspotover",this.My),b.addEventListener("onhotspotout", this.nu),b.addEventListener("onzoomstart",this.nu))},pT:function(){var a=this.B;a&&(a.removeEventListener("mousemove",this.Qy),a.removeEventListener("onhotspotover",this.My),a.removeEventListener("onhotspotout",this.nu))},IS:function(a){var b=this,c=b.B,d=c.na();if(c.ea()<this.dc||c.Tb())b.ZA();else if(a=d.Vo().lh(a.point),d=d.k.Nb,a=new P(Math.floor(a.x*Math.pow(2,c.ea()-18)),Math.floor(a.y*Math.pow(2,c.ea()-18))),d=new P(Math.floor(a.x/d),Math.floor(a.y/d)),this.Yp=c=d.x+"_"+d.y+"_"+c.ea(),this.Uk[c]){if(this.uu!= c){b.ZA();b.nG(this.Uk[c]);this.uu=c;for(var d=-1,a=0,e=this.Aj.length;a<e;a++)if(c==this.Aj[a]){d=a;break}0<=d&&(this.Aj.splice(d,d),this.Aj.push(c))}}else if(this.gG!=c){this.gG=c;d=Oc[parseInt(Math.random()*Oc.length)];a=b.nc;c=d+"/data?grids="+c+"&q="+a.Yx+"&tags="+a.Wt+"&filter="+a.filter+"&sortby="+a.uy+"&ak="+a.Ol+"&page_size="+a.cN+"&age="+a.fw;b.xf?c+="&geotable_id="+b.xf:b.Jn&&(c+="&databox_id="+b.Jn);var f=(1E5*Math.random()).toFixed(0);!z._rd&&(z._rd={});z._rd["_cbk"+f]=function(a){b.aS(a); delete z._rd["_cbk"+f]};Qb(c+("&callback=BMap._rd._cbk"+f))}},aS:function(a){var b=this.B,c=a.content;if(!(a.status!=this.fG||!c||1>c.length)){for(var a=[],d=c[0].data,b=b.na().Vo(),e=0,f=d.length;e<f;e++){var g=d[e][2].replace(kb.DT,"").split(","),g=b.oh(new H(g[0],g[1]));a.push({pt:g,userdata:{name:d[e][0]||"name",size:d[e][4]?d[e][4].split("|"):[10,13],uid:d[e][1]||"",RZ:d[e][3]||"sid1"}})}c=c[0].grid.join("_");this.Uk[c]=a;this.Aj.push(c);30<this.Aj.length&&(c=this.Aj.shift(),delete this.Uk[c], delete c);this.uu!=this.Yp&&(this.ZA(),this.Uk[this.Yp]&&(this.nG(this.Uk[this.Yp]),this.uu=this.Yp))}},nG:function(a){for(var b=this.B,c=0,d=a.length;c<d;c++){var e=a[c].userdata.size,f=e[0]/2,e=e[1]/2,f=new eb(a[c].pt,{offsets:[e,f,e,f],userData:a[c].userdata});b.aw(f,this.nc.wk)}},ZA:function(){this.B.Yl(this.nc.wk)},iS:function(a){if(a.spots&&!(1>a.spots.length||a.spots[0].tag!=this.nc.wk)){this.Eg=a.spots;var b=this,a=this.Eg[0].getUserData().size[0],c="",d=b.B,e="",f=b.nc.cY;0<this.Eg.length&& (c=this.Eg[0].getUserData().name);if(this.Gg)this.Gg.ra(this.Eg[0].ga()),this.Fg.Zc(c),this.Fg.Te(new M(a,0)),this.Gg.show(),c?this.Fg.show():this.Fg.R();else{var g=this.Eg[0].getUserData().size,e=this.Eg[0].getUserData().RZ,i=this.xf||this.Jn;this.Vk=new nc(E.oa+"blank.gif",new M(g[0],g[1]),{anchor:new M(g[0]/2+1,g[1]/2+1)});this.RR(i,e,function(){b.Gg&&b.Gg.Sb(b.Vk)});this.Gg=new U(this.Eg[0].ga(),{icon:this.Vk,enableMassClear:q});d.Ha(this.Gg);this.Fg=new rc(c,{offset:new M(a,0)});this.Fg.Hd({backgroundColor:f.backgroundColor, borderColor:f.borderColor});this.Gg.Xm(this.Fg);c?this.Fg.show():this.Fg.R();this.Gg.addEventListener("onclick",function(){if(!(b.Eg.length<1)&&b.Eg[0].getUserData().uid){var a=b.nc,c=a.CX;if(b.xf)c=a.DX;a=c+b.Eg[0].getUserData().uid+"?scope=2&ak="+a.Ol;b.xf&&(a=a+("&geotable_id="+b.xf));var d=(Math.random()*1E5).toFixed(0);!z._rd&&(z._rd={});z._rd["_cbk"+d]=function(a){b.QR(a);delete z._rd["_cbk"+d]};Qb(a+("&callback=BMap._rd._cbk"+d))}})}}},QR:function(a){var b=a.content;this.xf&&(b=a.contents[0]); if(a&&a.status==this.fG&&b){var a={poiId:b.uid||"",databoxId:b.databox_id||"",title:this.xf?b.title:b.name,address:this.xf?b.address:b.addr,phoneNumber:b.tel||"",postcode:b.zip||"",provinceCode:1*b.province_id||-1,province:b.province||"",cityCode:1*b.city_id||-1,city:b.city||"",districtCode:1*b.district_id||-1,district:b.district||"",point:this.xf?new H(b.location[0],b.location[1]):new H(b.longitude,b.latitude),tags:b.tag&&b.tag.replace(kb.GT,"").split(kb.ET),typeId:1*b.cla||-1,extendedData:b.ext|| {}},c=new w.lang.Ly("onhotspotclick");c.customPoi=a;c.content=b;this.dispatchEvent(c)}},hS:function(){this.Gg&&this.Gg.R();this.Fg&&this.Fg.R()},RR:function(a,b,c){var d=this,e=Pc+"?method=getstyle&databox="+a+"&sid="+b,f=(1E5*Math.random()).toFixed(0);if(!d.Vk||!(d.Vk.databoxid==a&&d.Vk.sid==b))!z._rd&&(z._rd={}),z._rd["_cbk"+f]=function(a){var b="";0==a.status&&(b="data:image/png;base64,"+a.content.sid1);0<b.length&&(d.Vk.zN(b),c&&c(a));delete z._rd["_cbk"+f]},Qb(e+("&callback=BMap._rd._cbk"+f))}}); ');
