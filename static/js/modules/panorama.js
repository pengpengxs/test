_jsload2&&_jsload2('panorama', 'Ee.prototype.rC=ga(2,function(){this.Mb.style[ie]="";this.zi=this.ji=q;this.tv("h");this.tv("v");this.Sd(ve,window);this.Sd(we);this.Sd(xe,window);this.Sd(ye,window);this.Sd(ze,window);this.options.uk||(this.Sd("DOMMouseScroll"),this.Sd("mousewheel"));this.options.yi&&this.Sd(Ae);this.options.qw&&clearInterval(this.cV);this.options.LM&&this.options.LM.call(this)});var bi=1; function ci(a,b){var c=a.width,d=a.height,e=180/Math.pow(2,b),f=1;F()&&(f=2);c=e/(1<c/d?d:c);f=Math.floor(b)+f;for(d=360/(2*Math.pow(2,f-2)*c);512<d;)f++,d=360/(2*Math.pow(2,f-2)*c);f>Vh&&(d*=Math.pow(2,f-Vh),f=Vh);f<bi&&(f=bi);d=Math.round(d);return{EL:f,iK:d}}var di=5063,ei=5062,fi=5061,gi=5060,Vh=5,bi=1; w.extend(Ma.prototype,{vb:function(){this.uQ();for(var a=0;a<z.jr.length;a++)z.jr[a](this);this.Wa!=p?"inter"===this.Ge?this.cF(this.Wa):this.dispatchEvent(new N("onid_changed")):this.Ib!=p&&(this.dispatchEvent(new N("onposition_changed")),this.dispatchEvent(new N("onposition_changed_inner")));this.k.visible?this.show():this.R();this.Jf!=p&&this.dispatchEvent(new N("onvisible_poi_type_changed"),{visiblePOIType:this.Jf});var a=p,b;for(b in this.Fe)a=this.Fe[b],delete this.Fe[b],this.Ha(a)},Ht:function(a){this.Jf= a||"none";this.dispatchEvent(new N("onvisible_poi_type_changed"),{visiblePOIType:this.Jf})},Ha:function(a){this.Fe[a.ed]=a;this.dispatchEvent(new N("onadd_overlay"),{overlay:a})},Rb:function(a){delete this.Fe[a.ed];this.dispatchEvent(new N("onremove_overlay"),{overlay:a})},j0:function(a,b){var c=L("div"),d=c.style;c.className="pano_m_indoor_exit";c.title=a;c.onclick=b;d.display="none";d.zIndex=1201;c.innerHTML=\'<span style="float:right;margin-right:12px;">\\u51fa\\u53e3</span>\';return c},i0:function(a, b){var c=L("div"),d=c.style;d.position="absolute";d.zIndex=1201;d.right=d.top="10px";d.width="17px";d.height="16px";d.background=\'url("\'+E.oa+\'st-close.png") no-repeat 50% 50%\';F()&&(d.right=d.top="0px",d.width="42.5px",d.height="40px",d.backgroundSize="25.5px 24px");d.cursor="pointer";c.title=a;c.onclick=b;d.display="none";return c},pc:function(a,b,c){"object"===typeof b&&(c=b,b=j);a!=this.Wa&&(this.kl=this.Wa,this.ll=this._position,this.Wa=a,this.dA=p,this.Ge=b||"street",c=c||{Sl:q},this.cJ=c.Sl, "inter"===b?this.cF(a):this.dispatchEvent(new N("onid_changed")),this.CZ(c))},CZ:function(a){this.iv={id:this.Xb(),pov:a.pov}},UW:function(a,b){var c,d;if(this.iv&&a===this.iv.id){c={};for(var e=0;e<b.length;e++)d=b[e],c[d]=this.iv[d];this.iv=p}return c},ra:function(a,b){a.lb(this.Ib)||(this.kl=this.Wa,this.ll=this._position,this.Ib=a,this.Wa=p,b=b||{Sl:q},this.cJ=b.Sl,this.dispatchEvent(new N("onposition_changed_inner")))},Kc:function(a){var b={heading:this.Ba.heading,pitch:this.Ba.pitch};this.Ba= a;a=a=this.Ba.pitch;a>this.Sj?a=this.Sj:a<this.Uj&&(a=this.Uj);this.Ba.pitch=a;if(b.heading!=this.Ba.heading||b.pitch!=this.Ba.pitch)this.qr=o,this.dispatchEvent(new N("onpov_changed"))},jy:function(a){var b=this.Ba,c=a.heading-b.heading,d=a.pitch-b.pitch,e=this;new pb({Fc:30,duration:200,gc:qb.vK,ta:function(a){e.Kc({heading:b.heading+a*c,pitch:b.pitch+a*d})},finish:function(){e.Kc(a)}})},Lc:function(a,b){if(a!=this.Ic){a>Hd&&(a=Hd);a<Id&&(a=Id);if(a!=this.Ic){this.Ic=a;var c=new N("onzoom_changed_inner"), b=b||{};c.mp=b.mp||q;this.dispatchEvent(c);(!La()||c.mp)&&this.dispatchEvent(new N("onzoom_changed"))}"cssRender"===this.Qq()&&this.Kc(this.Ba)}},hB:function(){if(this.B){for(var a=this.B.gx(),b=0;b<a.length;b++)(a[b]instanceof U||a[b]instanceof rc)&&a[b].point&&this.ua.push(a[b]);this.dispatchEvent(new N("onoverlay_changed"))}},vk:function(){this.tl.style.visibility="hidden"},oy:function(){this.dispatchEvent(new N("onoverlay_show"));this.tl.style.visibility="visible"},show:function(){this.k.visible= o;this.je&&w.C.show(this.je);this.k.closeControl&&(this.wf&&this.B&&this.B.La()===this.z)&&w.C.show(this.wf);this.IA&&this.IA.show();this.hB();this.dispatchEvent(new N("onvisible_changed"))},R:function(){this.k.visible=q;this.je&&w.C.R(this.je);this.k.closeControl&&this.wf&&w.C.R(this.wf);this.IA&&this.IA.R();this.dispatchEvent(new N("onvisible_changed"))},eF:function(a){this.B=a;this.hB()},uQ:function(){var a=L("div"),b=a.style;b.overflow="hidden";b.position="absolute";b.zIndex=1200;b.top=b.left= "0px";b.height=b.width="100%";b.backgroundColor="#e5e3df";this.je=a;this.Vh=this.Jj("1");this.Rj=this.Jj("4");this.tl=this.Jj("5");a.appendChild(this.Vh);a.appendChild(this.Rj);a.appendChild(this.tl);La()||(this.cr=this.Jj("3"),this.cr.style.width=this.z.clientWidth+"px",this.cr.style.height=this.z.clientHeight+"px",this.cr.style.overflow="hidden",this.cr.style.WebkitUserSelect="none",a.appendChild(this.cr),Rd()&&(this.Gv=this.OG(),this.Vh.appendChild(this.Gv),this.Hv=this.OG(),this.Vh.appendChild(this.Hv))); this.z.appendChild(a);"absolute"!=Ta(this.z).position&&(this.z.style.position="relative")},Jj:function(a){var b=L("div"),c=b.style;c.position="absolute";c.top=c.left="0";c.zIndex=a||"0";c.WebkitUserSelect="none";return b},OG:function(){var a=L("img");thumbStyle=a.style;thumbStyle.position="absolute";thumbStyle.top=thumbStyle.left="0";thumbStyle.zIndex="1";thumbStyle.opacity="0";thumbStyle.gc=thumbStyle.WebkitTransition="opacity 300ms ease-out";a.onload=function(){this.style.visibility="";this.style.opacity= "1"};return a},La:t("z"),eh:function(){return new M(this.z.clientWidth,this.z.clientHeight)},h2:t("Zj"),rX:t("Jv"),JN:ba("Jv"),cF:function(a){a!=this.dA&&(this.dA=a,this.Wa=p,this.dispatchEvent(new N("oniid_changed")),this.dispatchEvent(new N("onid_changed")),Pa(5045,{type:this.k.panoramaRenderer}))},clear:function(){this.Ib=this.Wa=this.da=p;this.Tn=[];this.dispatchEvent(new N("onclear"))},Jo:function(){var a=this.da.Wl;this.eR=this.da.UU;this.clear();this.WG=o;this.pc(a)}});var hi=Ma.prototype; T(hi,{setId:hi.pc,setPosition:hi.ra,setPov:hi.Kc,setZoom:hi.Lc,show:hi.show,hide:hi.R,setPanoramaPOIType:hi.Ht,addOverlay:hi.Ha,removeOverlay:hi.Rb,exitInter:hi.Jo});function ii(a){a.kg=this;var b=w.platform.Cm?"android":"ios";La()?(this.vd=new ji(a),this.gd=new ki(a,this.vd.Va),this.vd.uU(this.gd),"android"===b?Pa(gi):Pa(fi)):(this.vd=new li(a),this.gd=new mi(a),"android"===b?Pa(ei):Pa(di));a.k.linksControl?this.gd.show():this.gd.R();a.k.clickOnRoad?this.gd.RC():this.gd.wC();this.M=a;this.ba();this.WS=new ni(a,this)}z.Om(function(a){a.kg=new ii(a)});w.lang.sa(ii,w.lang.Aa,"PanoramaRenderer"); w.extend(ii.prototype,{ba:function(){var a=this.M,b=this;a.addEventListener("links_visible_changed",function(){a.k.linksControl===o?b.gd.show():b.gd.R()});a.addEventListener("clickonroad_changed",function(){a.k.clickOnRoad===o?b.gd.RC():b.gd.wC()});a.addEventListener("dataload",function(c){b.da=c.data;b.Cu();b.GI(c.data);b.ta(a.Ca(),b.$e,b.Vg)});a.addEventListener("pov_changed",function(){b.da&&b.ta(a.Ca(),b.$e,b.Vg)});a.addEventListener("clear",function(){b.da=p;b.GI(p);b.vd.ta();b.gd&&b.gd.ta()}); a.addEventListener("zoom_changed_inner",function(c){b.da&&(b.Cu(),b.NT(a.Ca(),b.$e,b.Vg,c.mp))});a.addEventListener("size_changed",function(a){b.aB(a)});a.addEventListener("dblclick",function(){var b=a.ea();4===b?a.Lc(1):a.Lc(b+1);a.dispatchEvent(new N("ondblclickzoomend"))});a.Yk=a.eh();setInterval(function(){if(a.Xb()){var c=a.eh();if(!c.lb(a.Yk)){a.Yk=c;var d=new N("onsize_changed");d.h3=a.Yk;d.size=c;a.dispatchEvent(d);c=b.$e;b.Cu();c!=b.$e&&b.vd.hp&&b.vd.hp();b.ta(a.Ca(),b.$e,b.Vg)}}},80);La()&& a.addEventListener("refresh",function(){b.vd.Fr()})},aB:function(){var a=this.$e;this.Cu();a!=this.$e&&this.vd.hp&&this.vd.hp();this.vd.Dk&&this.vd.Dk();this.gd.Dk&&this.gd.Dk();a=this.M;this.ta(a.Ca(),this.$e,this.Vg);"cssRender"===a.Qq()&&a.Kc(a.Ca())},GI:function(a){a&&("number"===typeof a.heading&&this.M.qr===q)&&(this.M.Ba.heading=a.heading,this.M.Ba.pitch=a.pitch);var b=this.M.UW(a&&a.id,["pov"]);b&&b.pov&&(this.M.Ba.heading=b.pov.heading,this.M.Ba.pitch=b.pov.pitch);if(this.M.WG&&a.indoorPois){for(var b= p,c=this.M.eR,d=0,e=a.indoorPois.length;d<e;d++)c==a.indoorPois[d].panoIId&&(b=a.indoorPois[d]);b&&(this.M.Ba.heading=Md(b.pointX-a.th,b.pointY-a.uh),this.M.Ba.pitch=0);this.M.WG=q;this.M.p0=p}this.M.qr&&(this.M.qr=q);this.M.Os();a&&a.Wl?this.M.ky("inter"):this.M.ky("street");this.vd.setData(a,this.FD(),this.$e);this.gd.setData(a)},NT:function(a,b,c,d){var e=this;this.vd.Lc(e.FD(),e.$e,{mp:d,XY:function(a){e.WS.sr(a)}});"cvsRender"!=this.M.Zj&&this.vd.ta(a,b,c);this.gd.ta(a,b,c)},ta:function(a,b, c){this.vd.ta(a,b,c);this.gd.ta(a,b,c)},X1:t("$e"),FD:function(){return this.M.ea()},O1:t("Vg"),Cu:function(){var a=ci(this.M.eh(),this.M.ea());this.Vg=a.iK;this.$e=a.EL}});function oi(a){this.M=a}z.Om(function(a){var b=new oi(a);a.addEventListener("dataload",function(a){b.da=a.data;b.Ni()});a.addEventListener("zoom_changed_inner",function(){b.kb&&(b.kb.stop(),b.kb=p)})}); oi.prototype.Ni=function(){function a(a,b){G.kg.vd.Og||(g=o,J.kb&&J.kb.stop(),i=a,k=b,A=G.Ca().heading,D=G.Ca().pitch,G.dispatchEvent(new N("ontouchstart")))}function b(a,b){g&&!G.Fl&&(y=o,J.rA||(J.rA=o,J.n0=Ya()),e(a,b),n=l-a,u=m-b,l=a,m=b,J.NH=Ya())}function c(a){g&&(g=q,!y&&(!C&&Z)&&J.KG&&(J.KG=q,J.Nn?(J.Ki&&(clearTimeout(J.Ki),J.Ki=p),10>i-J.Nn.x&&10>k-J.Nn.y&&G.dispatchEvent(new N("ondblclick")),J.Nn=p):(J.Nn={x:i,y:k},J.Ki=setTimeout(function(){var a,b,c=G.xA;a=G.je;var d=0;for(b=0;a.offsetParent;)d+= a.offsetLeft,b+=a.offsetTop,a=a.offsetParent;a=i-d;b=k-b;La()&&(a*=2,b*=2);0===c.qL(a,b)&&G.dispatchEvent(new N("onclick"));J.Nn=p},400))),J.rA=q,d(a),C=y=q)}function d(a){if(a){var b=Ya()-J.NH;if(!(100<b||10<b&&10>Math.abs(n)&&10>Math.abs(u))){var c;F()?(b=a.changedTouches[0].clientX,c=a.changedTouches[0].clientY):(b=a.clientX,c=a.clientY);a=new P(i,k);c=new P(b,c);var b=[0<c.x-a.x?1:-1,0<c.y-a.y?1:-1],d=Math.abs(a.x-c.x),f=0,g=0;0==Math.abs(a.y-c.y)?f=d:(a=Math.abs(a.x-c.x)/Math.abs(a.y-c.y),g= Math.round(Math.sqrt(24336/(1+a*a))),f=Math.round(a*g));-1==b[0]&&(f=-f);-1==b[1]&&(g=-g);J.kb&&J.kb.stop();A=G.Ca().heading;D=G.Ca().pitch;J.kb=new pb({duration:625,Fc:60,gc:function(a){return a*0.3125-0.15625*a*a},ta:function(a){a=a*6.4;e(a*f,a*g)},finish:function(){J.kb=p},lt:function(){J.kb=p}})}}}function e(a,b){v=-a*J.xu;x=b*J.xu;var c=A+v,d=D+x;d>G.Sj&&(d=G.Sj);d<G.Uj&&(d=G.Uj);G.Kc({heading:c,pitch:d})}function f(a){if(G.k.enableScrollWheelZoom){var a=window.event||a,b=new N("onmousewheel"); b.Op=0<=a.wheelDelta||0>a.detail;var c=new Date;if(!(220>c-ka)&&(ka=c,"path"!=(a.srcElement||a.target).tagName)){var c=la(b,a),d=a.srcElement||a.target,e=a.offsetX||a.layerX||0,f=a.offsetY||a.layerY||0;1!=d.nodeType&&(d=d.parentNode);for(;d&&d!=G.La();){d.aa&&(w.lang.Yd(d.aa)instanceof cb&&(overlay=w.lang.Yd(d.aa)),w.lang.Yd(d.aa)instanceof qc&&(infoWindow=w.lang.Yd(d.aa)));if(!(0==d.clientWidth&&0==d.clientHeight&&d.offsetParent&&"TD"==d.offsetParent.nodeName)&&"http://www.w3.org/2000/svg"!=d.namespaceURI)e+= d.offsetLeft||0,f+=d.offsetTop||0;else if("http://www.w3.org/2000/svg"==d.namespaceURI){var g=G.kg.gd&&G.kg.gd.cf||p;if(-1<navigator.userAgent.indexOf("Opera")&&"svg"!=d.tagName){if(d=w.lang.Yd(d.aa))d=d.Dd(),e+=J.$b(d.pe()).x,f+=J.$b(d.lf()).y;break}if(g&&(!w.ca.ka||9<=w.ca.ka&&"svg"==d.nodeName.toLowerCase()))e+=parseInt(g.style.left),f+=parseInt(g.style.top)}d=d.offsetParent}c.x=e;c.y=f;G.ea();G.Ca();G.Ca();var i;if(b.Op==o){if(G.ea()==Hd){zb(a);return}i=G.ea()+2/3}else if(b.Op==q){if(G.ea()== Id){zb(a);return}i=G.ea()-2/3}G.Lc(i)}zb(a)}}if(!this.oS){this.oS=o;var g=q,i,k,l=0,m=0,n,u,v=0,x=0,y=q,C=q,A,D,B,G=this.M,K=q,R=0;this.xu=pi(this);this.NH=0;this.rA=q;this.Nn=p;this.lg=1;var J=this,Z=q;F()?(w.K(G.je,"touchstart",function(b){Z=o;for(var c=b.target;c&&c!=G.je;){if(c===G.tl){Z=q;break}c=c.offsetParent}J.KG=o;var c=b.touches[0].clientX,d=b.touches[0].clientY,e=G.xA;if(La())e&&e.mH(b.touches[0].pageX*e.jg,b.touches[0].pageY*e.jg)!=p&&(Z=q);else if(!Jb()&&e){var f=yb(G.je);-1!=e.$K(c- f.left,d-f.top)&&(Z=q)}a(c,d);(!w.platform.Cm||-1==navigator.userAgent.indexOf("QQBrowser"))&&b.preventDefault();b.stopPropagation()}),w.K(G.je,"touchmove",function(a){if(!K){b(a.touches[0].clientX-i,a.touches[0].clientY-k);var c=new N("ontouchmove");c.O3=new P(a.touches[0].pageX,a.touches[0].pageY);G.dispatchEvent(c)}a.preventDefault();a.stopPropagation()}),w.K(document,"touchend",function(a){c(a);Z=q}),G.je.addEventListener("gesturestart",function(){R=G.ea()},q),G.je.addEventListener("gesturechange", function(a){J.lg=a.scale;C=K=o;a=J.lg*R;4<a?a=4:1>a&&(a=1);a=Math.round(100*a)/100;G.Lc(a,{mp:o})},q),G.je.addEventListener("gestureend",function(){K=q;G.ea()!=R&&G.dispatchEvent(new N("onpinchtozoomend"))},q)):(w.K(G.je,"mousedown",function(b){a(b.clientX||b.pageX||0,b.clientY||b.pageY||0);B=b.target||b.srcElement;w.ca.ka&&B.setCapture&&B.setCapture();J.kT=G.je.style.cursor;G.je.style.cursor=E.Bd;w.ca.ka||zb(b)}),w.K(document,"mousemove",function(a){b((a.clientX||a.pageX||0)-i,(a.clientY||a.pageY|| 0)-k);na(a)}),w.K(document,"mouseup",function(a){ma(a);c(a);w.ca.ka&&(B&&B.releaseCapture)&&B.releaseCapture();G.je.style.cursor=J.kT||E.Vb}));G.addEventListener("zoom_changed_inner",function(){J.xu=pi(J)});G.addEventListener("size_changed",function(){J.xu=pi(J)});var ka=new Date;w.K(G.La(),"mousewheel",f);window.addEventListener&&G.La().addEventListener("DOMMouseScroll",f,q)}}; function pi(a){if(!a.da)return p;var b=a.M,c=ci(b.eh(),b.ea()),d=c.EL,c=c.iK;if("cssRender"===b.Qq()&&!La())return 360/(a.da.tiles.Yo(d)*c);b=a.M.ea();return 180/Math.pow(2,b)/a.M.eh().height};function ni(a,b){w.lang.Aa.call(this);this.M=a;this.ya=b;this.Ph=[];this.Rh={};this.OA=q;this.fz()}w.lang.sa(ni,w.lang.Aa,"PanoramaOverlayMgr"); w.extend(ni.prototype,{fz:function(){var a=this,b=this.M;b.addEventListener("add_overlay",function(c){c=c.overlay;c.pa(b);a.Ph.push(c);a.ur()});b.addEventListener("dataload",function(){a.OA=o;a.ur()});b.addEventListener("remove_overlay",function(b){for(var b=b.overlay,d=0,e=a.Ph.length;d<e;d++)b==a.Ph[d]&&a.Ph.splice(d,1);b.remove();a.ur()});b.addEventListener("clear",function(){a.OA=q});b.addEventListener("zoom_changed",function(){a.sr()});b.addEventListener("dataload",function(){a.ur()});b.addEventListener("pov_changed", function(){a.sr()});b.addEventListener("size_changed",function(){a.sr()});b.addEventListener("onoverlay_property_changed",function(){a.ur()})},ur:function(){this.qT();if(0!=this.Ph.length&&this.OA){for(var a,b,c,d=this.Ph.length-1;0<=d;d--)if(b=this.Ph[d],ovarlayDom=b.Ed(),c=b.Ca())a=c.heading,b.oO(),b=b.ed,this.Rh[a]||(this.Rh[a]={}),this.Rh[a][b]={dom:ovarlayDom,pov:c},this.M.tl.appendChild(ovarlayDom);this.sr()}},sr:function(a){this.M.Ca();var a=a||this.ya.$e,b=this.ya.Vg,c=function(){function a(c){var d= b[c.top];if(!d)return q;for(var e=d.length-1;0<=e;e--)if(c.left>=d[e].left&&c.left<=d[e].right||c.right>=d[e].left&&c.right<=d[e].right)return o;return q}var b={};return function(c){for(;a(c);)c.top+=-36;b[c.top]?b[c.top].push(c):b[c.top]=[c];return c}}(),d;for(d in this.Rh)for(var e in this.Rh[d]){var f=this.Rh[d][e],g=this.bT(d,f.pov.pitch,a,b),f=f.dom,g=c({top:g[1],left:g[0],right:g[0]+f.offsetWidth});f.style.left=g.left-f.offsetWidth/2+"px";f.style.top=g.top+f.offsetHeight/2+"px"}},bT:function(a, b,c,d){if(La())return this.cT(a,b);var e=this.M;for(svHeading=e.Ca().heading%360;0>svHeading;)svHeading=(svHeading+360)%360;var f=(a-svHeading)%360,a=e.eh(),c=360/(2*Math.pow(2,c-2)*d);180<f?f-=360:-180>f&&(f+=360);d=Math.round(a.width/2+f/c);b=Math.round(a.height/2-(b-e.Ca().pitch)/c);return[d,b]},cT:function(a,b){var c=500*Math.cos(Lb(b)),c=Math.round(100*c)/100;"string"==typeof a&&(a=parseFloat(a));var d;d=a+this.M.da.tiles.dirNorth;d%=360;var e=this.M.kg.vd;d=Y.rg(Math.cos(Lb(d))*c,500*Math.sin(Lb(b)), Math.sin(Lb(d))*c,1);var c=Y.create(),f=e.Qh;qi.multiply(c,e.Ef[0],d);qi.multiply(c,f,c);if(0>c[3])return[-1E3,-1E3];e=this.M.Yk;return[(c[0]/c[3]+1)/2*e.width,(1-c[1]/c[3])/2*e.height]},qT:function(){for(var a in this.Rh)for(var b in this.Rh[a]){var c=this.Rh[a][b].dom;c.parentNode.removeChild(c)}this.Rh={}}});w.extend(Ld.prototype,{pa:function(a){this.M=a;this.ga()||this.ra(this.M.ga());this.zz();this.dz()},Ed:t("ad"),hide:function(){this.Oa=q;this.ad&&(this.ad.style.display="none")},show:function(){this.Oa=o;this.ad&&(this.ad.style.display="block")},isVisible:t("Oa"),oO:function(){var a=this.On();100<a?(a/=1E3,a=100>a?a.toFixed(2):a.toFixed(0),a+="\\u516c\\u91cc"):(a=100>a?a.toFixed(2):a.toFixed(0),a+="\\u7c73");this.Aq.innerHTML=a},zz:function(){var a=this.pk(),b=L("div"),c=b.style;c.position="absolute"; c.backgroundColor="rgba(29, 29, 29, 0.8)";c.padding="7px 0";c.height="19px";c.font="16px arial";c.color="white";c.whiteSpace="nowrap";c.borderRadius="4px";c.left="-1000px";c.top="-1000px";c=L("div");c.style["float"]="left";c.style.lineHeight="19px";b.appendChild(c);var d=L("span");d.style.margin="0 14px";d.innerHTML=a;c.appendChild(d);a=L("span");a.style.color="color:rgba(255,255,255,0.3)";a.innerHTML="|";c.appendChild(a);var e=L("span");e.style.margin="0 8px";e.style.color="#60c7fa";e.style.fontSize= "12px";e.innerHTML="0\\u7c73";c.appendChild(e);this.KQ===q&&(e.style.display="none",a.style.display="none");this.ad=b;this.Aq=e;this.Lr=d},dz:function(){var a=this;this.lQ(this.ad,function(b){a.dispatchEvent(new N("onclick"),{type:"click",target:a});zb(b)});w.K(this.ad,"mouseenter",function(){a.dispatchEvent(new N("onmouseover"),{type:"mouseover",target:a})});w.K(this.ad,"mouseleave",function(){a.dispatchEvent(new N("onmouseout"),{type:"mouseout",target:a})})},lQ:function(a,b){if(F()){var c=0,d=0, e=0;a.addEventListener("touchstart",function(a){c=(new Date).getTime();d=a.touches[0].pageX;e=a.touches[0].pageY},q);a.addEventListener("touchend",function(a){200<=(new Date).getTime()-c||(5<=Math.abs(a.changedTouches[0].pageX-d)||5<=Math.abs(a.changedTouches[0].pageY-e))||b.call(this,a)},q)}else w.K(this.ad,"click",b)},If:function(a,b){this.ad&&("content"===a&&(this.Lr.innerHTML=b),this.M.dispatchEvent(new N("onoverlay_property_changed")))},remove:function(){this.ad=this.Aq=this.Lr=p;this.dispatchEvent(new N("onremove"), {type:"remove",target:this})}});w.extend(Od.prototype,{pa:function(a){this.M=a;this.zz();(a=this.DD())&&(a.panoId||a.panoIId)&&this.dz(a)},Ed:t("ad"),hide:function(){this.Oa=q;this.ad.style.display="none"},show:function(){this.Oa=o;this.ad.style.display="block"},isVisible:t("Oa"),oO:function(){var a=this.M.ga(),b=this.ga(),a=Q.Oo(a,b);100<a?(a/=1E3,a=100>a?a.toFixed(2):a.toFixed(0),a+="\\u516c\\u91cc"):(a=100>a?a.toFixed(2):a.toFixed(0),a+="\\u7c73");this.Aq.innerHTML=a},dz:function(a){var b=this;if(a.panoIId){var c=function(c){b.M.cF(a.panoIId); c.stopPropagation();c.preventDefault()};F()?w.K(this.Rq,"touchend",function(a){c(a)}):(this.Rq.style.cursor="pointer",w.K(this.Rq,"click",function(a){c(a)}))}if(a.panoId){var d=function(c){function d(){b.M.Kc(b.Ca());b.M.removeEventListener("dataload",d)}var g=a.panoId;b.M.Xb()!=g&&(b.M.pc(g),b.M.addEventListener("dataload",d));c.stopPropagation();c.preventDefault()};w.K(this.ad,"touchend",function(a){d(a)});this.ad.style.cursor="pointer";w.K(this.ad,"click",function(a){d(a)})}},zz:function(){var a= this.Xo(),b=L("div"),c=b.style;c.position="absolute";c.backgroundColor="rgba(29, 29, 29, 0.8)";c.padding="7px 0";c.height="19px";c.font="16px arial";c.color="white";c.whiteSpace="nowrap";c.borderRadius="4px";c.left="-1000px";c.top="-1000px";var d=L("img");d.src=this.Po();d.style.width="24px";d.style.height="24px";d.style.position="absolute";d.style.left="5px";d.style.top="5px";c.paddingLeft="40px";b.appendChild(d);c=L("div");c.style["float"]="left";c.style.lineHeight="19px";b.appendChild(c);var e= L("span");e.style.margin="0 14px";e.innerHTML=a;c.appendChild(e);a=L("span");a.style.color="color:rgba(255,255,255,0.3)";a.innerHTML="|";c.appendChild(a);a=L("span");a.style.margin="0 8px";a.style.color="#60c7fa";a.style.fontSize="12px";a.innerHTML="0\\u7c73";c.appendChild(a);this.ad=b;this.Rq=d;this.Aq=a;this.Lr=e},If:function(a,b){switch(a){case "title":this.Lr.innerHTML=b;break;case "altitude":this.M.dispatchEvent(new N("onoverlay_position_changed"));break;case "position":this.M.dispatchEvent(new N("onoverlay_position_changed"))}}, remove:function(){this.Lr=this.Aq=this.Rq=this.ad=p;this.dispatchEvent(new N("onremove"),{type:"remove",target:this})}});w.extend(function(a){this.Ni(a)}.prototype,{Ni:function(a){this.M=a;this.no=this.mo=o;this.ya();this.ba()},ya:function(){this.z=L("div");var a=this.z.style;a.position="absolute";a.left="10px";a.top="10px";a.zIndex=1201;a=this.z;a.innerHTML=this.Jq();Sa()?(this.fd=w.W(a.children[2]),this.Yn=[w.W(this.fd.children[0]),w.W(this.fd.children[1]),w.W(this.fd.children[2]),w.W(this.fd.children[3])],Jb()?this.UI=w.W(a.children[1].childNodes[0]):Ib()&&(this.eJ=w.W(a.children[1].childNodes[0])),this.Ud=w.W(a.children[3])): F()&&(this.Ud=w.W(a.children[0]));this.Bh=w.W(this.Ud.children[0]);this.ag=w.W(this.Ud.children[1]);w.ca.ka&&(this.fd.style.background=\'url("\'+E.oa+\'blank.gif") repeat\');6==w.ca.ka&&this.BT();F()&&(this.Ud.style.left=this.Ud.style.top="0",this.Ud.style.width="36px",this.Ud.style.height="78px",this.Bh.style.width=this.ag.style.width="33px",this.Bh.style.height=this.ag.style.height="36px",this.ag.style.top="37.5px");this.M.ea()==Hd&&this.co("zoomIn",q);this.M.ea()==Id&&this.co("zoomOut",q);this.M.La().appendChild(a)}, Jq:function(){var a=[];Sa()&&(a.push(this.Nz()),a.push(this.qR()),a.push(this.sR()));a.push(this.Oz());return a.join("")},qR:function(){if(Jb())return\'<svg version="1.1" overflow="hidden" width="82px" height="82px" viewBox="0 0 82 82" style="position: absolute; top: 0px; left: 0px;"><g transform="rotate(0, 41, 41)"><rect x="33" y="1" width="14" height="12" rx="4" ry="4" stroke="#868685" stroke-width="1" fill="#f8f8f8"></rect><polyline points="37.5,9.5 37.5,3.5 42.5,9.5 42.5,3.5" stroke-linejoin="bevel" stroke-width="1.5" fill="#f2f4f6" stroke="#868685"></polyline></g></svg>\'; if(Ib())return\'<div style="position:absolute;top:0;left:0;z-index:0"><v:group style="position:absolute;width:82px;height:82px; behavior:url(#default#VML);rotation:0" unselectable="on" coordsize="82,82" coordorigin="-41,-41"><v:roundrect style="width:14px;height:12px;top:-40px; behavior:url(#default#VML);left:-7px;z-index:2" fillcolor="#f8f8f8" arcsize ="19661f" coordsize="21600,21600" strokecolor="#868685" strokeweight="1pt"></v:roundrect><v:polyline style="behavior: url(#default#VML);z-index:3" fillcolor="#f2f4f6" points="-3,-31,-3,-37,3,-31,3,-37" strokeweight="1.2pt"><v:stroke style="behavior:url(#default#VML)" color="#868685" joinstyle="bevel"></v:stroke></v:polyline></v:group></div>\'}, Nz:function(){return\'<div style="position:absolute;top:4px;left:4px;width:74px;height:74px;background:url(\'+E.oa+\'st-navictrl.png) no-repeat;-webkit-user-select:none;overflow:hidden"><div></div></div>\'},sR:function(){return\'<div style="position:absolute;top:0px;left:0;width:82px;height:82px;-webkit-user-select:none;cursor:\'+E.Vb+\'"><div style="position:absolute;left:32px;top:13px;cursor:pointer;width:17px;height:17px;" title="\\u5411\\u4e0a\\u5e73\\u79fb"></div><div style="position:absolute;left:14px;top:32px;cursor:pointer;width:17px;height:17px;" title="\\u5411\\u5de6\\u5e73\\u79fb"></div><div style="position:absolute;left:51px;top:32px;cursor:pointer;width:17px;height:17px;" title="\\u5411\\u53f3\\u5e73\\u79fb"></div><div style="position:absolute;left:33px;top:51px;cursor:pointer;width:17px;height:17px;" title="\\u5411\\u4e0b\\u5e73\\u79fb"></div></div>\'}, Oz:function(){var a="background-image:url(\'"+E.oa+"st-navictrl.png\');background-repeat:no-repeat;background-position:-74px 0;";F()&&(a="background-image:url(\'"+E.oa+"st-navictrl-hd.png\');background-repeat:no-repeat;background-position:0 0;background-size:180px 78px;");return\'<div style="position:absolute;top:84px;left:30px;width:24px;height:52px;\'+a+\'-webkit-user-select:none;overflow:hidden"><div style="position:absolute;cursor:pointer;width:22px;height:24px;top:0;left:0;-webkit-user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0)" title="\\u653e\\u5927\\u4e00\\u7ea7"></div><div style="position:absolute;cursor:pointer;width:22px;height:24px;top:25px;left:0;-webkit-user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0)" title="\\u7f29\\u5c0f\\u4e00\\u7ea7"></div><div></div></div>\'}, ba:function(){var a=this.M,b=this;if(Sa()){w.K(this.Yn[0],"click",function(){var b=a.Ca();a.jy({heading:b.heading,pitch:b.pitch+30})});w.K(this.Yn[1],"click",function(){var b=a.Ca();a.jy({heading:b.heading-45,pitch:b.pitch})});w.K(this.Yn[2],"click",function(){var b=a.Ca();a.jy({heading:b.heading+45,pitch:b.pitch})});w.K(this.Yn[3],"click",function(){var b=a.Ca();a.jy({heading:b.heading,pitch:b.pitch-30})});for(var c=0;c<this.Yn.length;c++)w.K(this.Yn[c],"mousedown",ma);b.hv=q;w.K(this.fd,"mousedown", function(c){b.hv=o;b.fd.style.cursor=E.Bd;w.ca.ka&&b.fd.setCapture&&b.fd.setCapture();b.SI=b.BG(c);b.FQ=a.Ca().heading;w.ca.ka||zb(c)});w.K(document,"mousemove",function(c){b.hv&&a.Kc({heading:b.FQ+360-(b.BG(c)-b.SI),pitch:a.Ca().pitch})});w.K(document,"mouseup",function(){b.hv&&(b.hv=q,b.fd.style.cursor=E.Vb,w.ca.ka&&b.fd.releaseCapture&&b.fd.releaseCapture(),b.SI=p)});a.addEventListener("position_changed",function(){var c=360-this.Ca().heading;Jb()?b.UI.setAttribute("transform","rotate("+c+", 41, 41)"): Ib()&&(b.eJ.style.rotation=c);a.removeEventListener("position_changed",arguments.callee)});a.addEventListener("pov_changed",function(){var a=360-this.Ca().heading;Jb()?b.UI.setAttribute("transform","rotate("+a+", 41, 41)"):Ib()&&(b.eJ.style.rotation=a)})}w.K(this.z,"mousemove",function(){a.dispatchEvent(new N("hide_ellipse"))});w.K(this.z,"mouseout",function(){a.dispatchEvent(new N("show_ellipse"))});w.K(this.Bh,"click",function(){a.Lc(a.ea()+1)});w.K(this.ag,"click",function(){a.Lc(a.ea()-1)});Sa()? (w.K(this.Bh,"mousedown",function(){b.Yj(b.mo,-98)}),w.K(this.ag,"mousedown",function(){b.Yj(b.no,-122)}),w.K(this.Bh,"mouseup",function(){b.Yj(b.mo,-74)}),w.K(this.ag,"mouseup",function(){b.Yj(b.no,-74)})):F()&&(w.K(this.Bh,"touchstart",function(){b.Yj(b.mo,-98)}),w.K(this.ag,"touchstart",function(){b.Yj(b.no,-122)}),w.K(this.Bh,"touchend",function(){b.Yj(b.mo,-74)}),w.K(this.ag,"touchend",function(){b.Yj(b.no,-74)}));this.M.addEventListener("zoom_changed_inner",function(){if(this.ea()==Hd)b.co("zoomIn", q);else if(this.ea()==Id)b.co("zoomOut",q);else{b.co("zoomIn",o);b.co("zoomOut",o)}})},Yj:function(a,b){a&&(6==w.ca.ka?this.Ud.children[2].style.left=b+"px":(F()&&(b=36*((b+74)/24)),this.Ud.style.backgroundPosition=b+"px 0"))},BT:function(){var a=this.z.children[0];a.style.background="";a.children[0].style.cssText+="position:absolute;left:0;top:0;width:98px;height:74px;filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\'"+E.oa+"st-navictrl.png\')";this.Ud.style.background="";this.Ud.children[2].style.cssText+= "position:absolute;z-index:-1;left:-74px;top:0;width:98px;height:74px;filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\'"+E.oa+"st-navictrl.png\')"},show:function(){this.z.style.display=""},R:function(){this.z.style.display="none"},BG:function(a){var a=window.event||a,b=a.pageX||a.clientX,a=a.pageY||a.clientY,c=yb(this.M.La()),b=b-c.left-50,a=-(a-c.top-50),b=180*(Math.atan2(a,b)/Math.PI);return 90>b?90-b:450-b},co:function(a,b){var c=this.Ud.children[2];if("zoomIn"==a)if(b)if(this.mo= o,this.Bh.style.cursor="pointer",6==w.ca.ka)c.style.left="-74px";else{var d=-74;F()&&(d=0);this.Ud.style.backgroundPosition=d+"px 0"}else this.mo=q,this.Bh.style.cursor="",6==w.ca.ka?c.style.left="-170px":(d=-170,F()&&(d=-144),this.Ud.style.backgroundPosition=d+"px 0");"zoomOut"==a&&(b?(this.no=o,this.ag.style.cursor="pointer",6==w.ca.ka?c.style.left="-74px":(d=-74,F()&&(d=0),this.Ud.style.backgroundPosition=d+"px 0")):(this.no=q,this.ag.style.cursor="",6==w.ca.ka?c.style.left="-146px":(d=-146,F()&& (d=-108),this.Ud.style.backgroundPosition=d+"px 0")))}});function ri(a,b){this.lB=a;this.We=[];this.nc={yo:p};var b=b||{},c;for(c in b)this.nc[c]=b[c]}ri.prototype.setData=function(a,b){if(0!==this.lB){if(this.We.length>this.lB){for(var c=Math.round(0.6*this.lB),d=0;d<c;d++){var e=this.We[d].MH;this.nc.yo&&this.nc.yo(this.We[e]);delete this.We[e]}this.We.splice(0,c)}this.We[a]||this.We.push(b);this.We[a]=b;b.MH=a}};ri.prototype.getData=function(a){return this.We[a]}; ri.prototype.clear=function(){for(var a=0;a<this.We.length;a++){var b=this.We[a].MH;this.nc.yo&&this.nc.yo(this.We[b]);delete this.We[b]}this.We=[]};function si(){this.wz=0;this.Kg={}}si.prototype.Ww=function(){var a=p,b;for(b in this.Kg)if(this.Kg[b]&&this.Kg[b].Mz===o)return this.Kg[b].Mz=q,this.Kg[b];a=new Image;this.wz++;b="img_"+this.wz;return this.Kg[b]=a};si.prototype.clear=function(){for(var a in this.Kg)this.Kg[a]&&(this.Kg[a].onload=this.Kg[a].onerror=p);this.Kg={};this.wz=0};function li(a){this.M=a;return"cvsRender"==a.Zj?new ti(a):new ui(a)};function ti(a){this.M=a;this.Vh=a.Vh;this.Jj();this.M.qa=this;this.ba()} w.extend(ti.prototype,{ba:function(){var a=this,b=a.M;b.addEventListener("size_changed",function(c){a.ve(b.kg.$e,b.kg.FD(),c.size)})},setData:function(a,b,c){a&&(this.da=a,this.yS(b,c))},Jj:function(){var a=L("canvas");a.width=this.M.La().clientWidth;a.height=this.M.La().clientHeight;var b=a.style;b.position="absolute";b.left=b.top="0";this.Vh.appendChild(a);this.$U=a.getContext("2d");this.si=[];this.AJ=[];this.Tc=new vi(this.$U,this.si,0,a.width,a.height,this.M);for(a=b=a=0;16>a;a++){this.si[a]= [];for(b=0;8>b;b++){var c=new wi(this.M);c.lM=a;c.mM=b;c.canvas=this.Tc;this.si[a][b]=c}}this.M.X0=this.Tc},ta:function(a,b){if(a&&b){var c=a.heading%360,d=a.pitch;this.Yz({heading:c,pitch:d},b);this.Tc.fi({heading:c,pitch:d},b)}},yS:function(a,b){this.Tc.FV();this.tR(this.da);this.Tc.xX(this.da);this.yI(a,b);this.Wz(b,o)},Lc:function(a,b){var c=this,d=o;b==this.Tc.qa.zoom&&(d=q);this.yI(a,b);d&&this.Wz(b,o);setTimeout(function(){c.Yz()},1E3)},tR:function(a){var b=this,c=a.tiles,d={qe:[]};d.qe[0]= new Image;d.qe[0].src=c.getTilesUrl(a.id,{x:0,y:0},2);d.qe[1]=new Image;d.qe[1].src=c.getTilesUrl(a.id,{x:1,y:0},2);b.AO=0;d.qe[0].onload=function(){b.Gx()};d.qe[1].onload=function(){b.Gx()};this.AJ[0]=d},Gx:function(){this.AO++;2==this.AO&&(this.Tc.IZ(this.AJ[0].qe),this.Tc.Gx())},Yz:function(a,b){if(this.da&&this.da.tiles)for(var c=this.da.tiles,d=[],b=b||this.Tc.qa.zoom,d=this.si,e=this.Tc.oD(a),f=e.eu,g=e.qs,i=e.ft,e=e.zt,e=e>i?e-i:64+e-i,k=0,l=0,m=0;m<e+Math.pow(2,7-b);){for(var n=f;n<g+Math.pow(2, 7-b);){k=m+i;63<k?k%=64:0>k&&(k+=64);k=Math.floor(k*Math.pow(2,b-7));l=Math.floor(n*Math.pow(2,b-7));if(k<Math.pow(2,b-1)&&l<Math.pow(2,b-2)&&0==d[k][l].fm){var u=c.getTilesUrl(this.da.id,{x:k,y:l},b);d[k][l].KN(u)}n+=Math.pow(2,7-b)}m+=Math.pow(2,7-b)}},Wz:function(a,b){var c=q;b&&(c=o);if(!c)if(this.Fy)this.Fy=q;else return;if(this.da&&this.da.tiles){for(var c=this.da.tiles,d=[],e=Math.pow(2,a-1),f=Math.pow(2,a-2),d=this.si,g=0;g<e;g++)for(var i=0;i<f;i++)d[g][i].$Y();for(var g=this.Tc.oD(),e=g.eu, f=g.qs,k=g.ft,g=g.zt,l=g>k?g-k:64+g-k,m=0,n=0,g=0;g<l+Math.pow(2,7-a);){for(i=e;i<f+Math.pow(2,7-a);){m=g+k;63<m?m%=64:0>m&&(m+=64);m=Math.floor(m*Math.pow(2,a-7));n=Math.floor(i*Math.pow(2,a-7));if(m<Math.pow(2,a-1)&&n<Math.pow(2,a-2)){var u=c.getTilesUrl(this.da.id,{x:m,y:n},a);d[m][n].KN(u)}i+=Math.pow(2,7-a)}g+=Math.pow(2,7-a)}}},ve:function(a,b,c){a!=this.Tc.qa.zoom&&(this.Fy=o);this.Tc.Dk(a,b,c);this.Wz(a);this.Yz();this.Tc.refresh()},yI:function(a,b){var c=q;b==this.Tc.qa.zoom?this.Fy=q:(this.Fy= o,b<this.Tc.qa.zoom&&(c=o));this.Tc.aZ(a,b);return c},ZW:function(a){return this.Tc.aX(a)},rD:function(a,b){return this.Tc.rD(a,b)},k2:function(){return this.Tc.qa.za}}); function wi(a){this.qe=new Image;this.src="";this.canvas=p;this.mM=this.lM=this.fm=0;this.M=a;var b=this;this.DL=function(){-1!=b.src.indexOf("pos=0_0&z=1")&&b.M.dispatchEvent(new N("onthumbnail_complete"));b.fm=2;b.canvas.XV(b.lM,b.mM)};this.qe.onload=this.DL;this.KN=function(a){this.src==a?0==this.fm&&b.DL():(this.src=this.qe.src=a,this.fm=1)};this.$Y=function(){this.src=this.qe.src="";this.fm=0}} function vi(a,b,c,d,e,f){this.heading=this.pitch=0;this.zoom=2;this.si=b;this.Ck=[];this.pg=a;this.Ql=q;this.qa={a:d,Ya:e,Mf:0,Tr:0,za:0,Z_:512,heading:0,pitch:0,$c:32,zoom:0,yp:0,uo:0,Pp:0,S0:0,Nm:0,T0:0,Mp:0,vt:0};this.M=f;this.Vs=q;this.xP()} w.extend(vi.prototype,{xP:function(){if(w.ca.RB){var a=navigator.userAgent.substr(navigator.userAgent.indexOf("Chrome"),12);27<Number(/[1-9][0-9]*/.exec(a+"1")[0])?(this.qa.uo=0.0078125,this.qa.vt=2):(this.qa.uo=0.015625,this.qa.vt=4);this.qa.Nm=0;this.qa.Mp=0}else w.ca.ka?(this.qa.uo=0.0078125,this.qa.Nm=0,this.qa.Mp=6):(this.qa.uo=0.0078125,this.qa.Nm=0,this.qa.Mp=4),this.qa.vt=2},IZ:ba("Ck"),Uw:function(){var a=this.qa,b=Math.PI/Math.pow(2,this.qa.yp);b>Math.PI/2+0.1&&(b=2*Math.PI/3);return a.a/ 2/Math.tan(b/2)},Dk:function(a,b,c){var d=this.qa;d.a=c.width;d.Ya=c.height;this.pg.canvas.width=c.width;this.pg.canvas.height=c.height;d.zoom=a;d.yp=b;d.za=this.Uw();d.$c=16*Math.pow(2,a-2);d.wt=Math.pow(2,a-1);d.Rm=Math.pow(2,a-2);d.rp=Math.pow(2,7-a)},aZ:function(a,b){var c=this.qa;if(0==this.qa.za)c.zoom=b,c.yp=a,c.za=this.Uw(),c.$c=16*Math.pow(2,b-2),c.wt=Math.pow(2,b-1),c.Rm=Math.pow(2,b-2),c.rp=Math.pow(2,7-b),c.Pp=c.uo*Math.pow(2,-a);else if(!(a==c.yp&&b==c.zoom)){this.Ql=o;var d=this.qa.za; c.$c=16*Math.pow(2,b-2);c.zoom=b;c.yp=a;c.wt=Math.pow(2,b-1);c.Rm=Math.pow(2,b-2);c.rp=Math.pow(2,7-b);d=(this.Uw()-d)/32;this.M.vk();this.kJ(0,d);c.Pp=c.uo*Math.pow(2,-a)}},xX:function(a){this.qa.heading-=this.qa.Mf/180*Math.PI;this.qa.Mf=a.tiles.dirNorth;this.qa.heading+=a.tiles.dirNorth/180*Math.PI;this.qa.Tr=a.tiles.pitch||0},kJ:function(a,b){var c=this;if(5>a)this.qa.za+=b*Math.pow(2,a),this.aR(),setTimeout(function(){c.kJ(a+1,b)},0);else if(5==a){this.Ql=q;var d=this.qa.zoom;this.qa.za=this.Uw(); this.qa.$c=16*Math.pow(2,d-2);this.qa.wt=Math.pow(2,d-1);this.qa.Rm=Math.pow(2,d-2);this.qa.rp=Math.pow(2,7-d);this.M.oy();this.refresh()}},d3:function(a,b){this.Ql=o;var c=this.qa;this.xE={data:a,GU:b};this.xE.jd=0;var d=Math.cos((a.dir+c.Mf)/180*Math.PI),c=-Math.sin((a.dir+c.Mf)/180*Math.PI),c=d=0;this.M.vk();this.WQ({index:1,h1:d,i1:c})},XV:function(a,b){if(!this.Ql&&this.Vs)if(1<this.qa.yp)this.refresh();else{var c=this.qa,d=c.$c,e=512/d,f=c.rp,g=Math.cos(c.pitch),i=Math.cos(c.heading),k=Math.sin(c.heading), l=c.za*Math.sin(c.pitch),m=c.za*g*k;c.aq=-c.za*g*i;c.bq=l;c.cq=m;c.Wr=i;c.Ot=k;for(g=0;g<e;g++)for(i=0;i<e;i++){k={nb:{x:g*d,y:i*d-1},ob:{x:g*d-1,y:i*d+d+1},pb:{x:g*d+d+1,y:i*d+d}};l={nb:{x:g*d-1,y:i*d},ob:{x:g*d+d+1,y:i*d-1},pb:{x:g*d+d,y:i*d+d+1}};if(0==g)var n=-1;else g==f-1&&(n=1);if(0==i)var u=-1;else i==f-1&&(u=1);this.MC(k,a,b,c.zoom,n,u);this.NC(l,a,b,c.zoom,n,u)}}},WQ:function(){var a=this.qa;this.pg.clearRect(0,0,a.a,a.Ya);a.heading-=a.Mf/180*Math.PI;a.Mf=this.xE.GU.i3;a.heading+=a.Mf/180* Math.PI;this.Ck=this.xE.data.qe;this.Ql=q;this.M.oy();this.refresh()},xn:function(a,b,c,d,e){var c=this.qa,b=2*(0.5*a.x/512+b/2)*Math.PI,f=(0.5-a.y/512)*Math.PI,g=c.za,a=Math.cos(f),i=Math.sin(Math.abs(f));0.4>i?i=0.4:0.98<i&&(i=c.vt);var b=b+d*i,k=-a*Math.cos(b),i=Math.sin(f+e*i),l=a*Math.sin(b),e=c.Wr,d=c.Ot,b=c.aq,a=c.bq,f=c.cq,m=b*k+i*a+l*f;0>m&&(m=q);m=g*g/m;g=m*k-b;k=m*i-a;l=m*l-f;m=Math.pow(g,2)+Math.pow(k,2)+Math.pow(l,2);i=Math.sqrt(m);0==m?d=e=0:(m=(g*d+l*e)/i,1<m?m=1:-1>m&&(m=-1),m=Math.acos(m), 0>g*e*a+k*d*f-k*e*b-l*a*d&&(m=2*Math.PI-m),e=i*Math.cos(m),d=i*Math.sin(m));return{x:c.a/2+e,y:c.Ya/2-d}},qK:function(a,b,c,d,e,f){var g=this.pg,i=0,k=0,l=0,m=0,n=this.qa.Pp;d&&(1==d?k=n:-1==d&&(i=n));e&&(-1==e?l=n:1==e&&(m=n));d=this.qa.Nm;i=this.xn(a.nb,b,c,-d-i,l,f);if(!i)return q;l=this.xn(a.ob,b,c,d+k,d+l,f);if(!l)return q;c=this.xn(a.pb,b,c,k,-d-m,f);if(!c)return q;c={nb:i,ob:l,pb:c};f=c.nb;k=c.ob;m=c.pb;g.save();g.beginPath();g.moveTo(f.x,f.y);g.lineTo(k.x,k.y);g.lineTo(m.x,m.y);g.closePath(); g.clip();a=this.tk(a,c);g.transform(a[0],a[1],a[2],a[3],a[4],a[5]);g.drawImage(this.Ck[b],0,0);g.restore()},pK:function(a,b,c,d,e,f){var g=this.pg,i=0,k=0,l=0,m=0,n=this.qa.Pp;d&&(1==d?k=n:-1==d&&(i=n));e&&(-1==e?l=n:1==e&&(m=n));d=this.qa.Nm;l=this.xn(a.nb,b,c,-i,d+l,f);if(!l)return q;i=this.xn(a.ob,b,c,-d-i,-d-m,f);if(!i)return q;c=this.xn(a.pb,b,c,d+k,-m,f);if(!c)return q;c={nb:l,ob:i,pb:c};f=c.nb;k=c.ob;m=c.pb;g.save();g.beginPath();g.moveTo(f.x,f.y);g.lineTo(k.x,k.y);g.lineTo(m.x,m.y);g.closePath(); g.clip();a=this.tk(a,c);g.transform(a[0],a[1],a[2],a[3],a[4],a[5]);g.drawImage(this.Ck[b],0,0);g.restore()},FV:function(){this.Vs=q;this.M.vk()},Gx:function(){this.Vs=o;this.refresh();this.M.oy()},fi:function(a){if(this.Vs&&!this.Ql){var b=this.qa;b.pitch=a.pitch/180*Math.PI-b.Tr/180*Math.PI;b.heading=(a.heading+b.Mf)/180*Math.PI;b.heading>2*Math.PI?b.heading-=2*Math.PI:0>b.heading&&(b.heading+=2*Math.PI);a=b.$c;this.pg.clearRect(0,0,b.a,b.Ya);var c=b.bound,d=c.eu,e=c.qs,f=c.ft,c=c.zt,c=c>f?c-f:64+ c-f,g=b.rp,i=b.Mp,k=Math.cos(b.pitch),l=Math.cos(b.heading),m=Math.sin(b.heading),n=b.za*Math.sin(b.pitch),u=b.za*k*m;b.aq=-b.za*k*l;b.bq=n;b.cq=u;b.Wr=l;b.Ot=m;for(k=0;k<c;k++)for(l=d;l<e;l++){u=k+f;63<u?u%=64:0>u&&(u+=64);var m=Math.floor(u/g),n=Math.floor(l/g),u=u%g,v=l%g,x={nb:{x:u*a,y:v*a-i},ob:{x:u*a-i,y:v*a+a+i},pb:{x:u*a+a+i,y:v*a+a}},y={nb:{x:u*a-i,y:v*a},ob:{x:u*a+a+i,y:v*a-i},pb:{x:u*a+a,y:v*a+a+i}};if(0==u)var C=-1;else u==g-1&&(C=1);if(0==v)var A=-1;else v==g-1&&(A=1);this.MC(x,m,n,b.zoom, C,A);this.NC(y,m,n,b.zoom,C,A)}}},refresh:function(){if(this.Vs&&!this.Ql){var a=this.qa,b=a.$c;this.pg.clearRect(0,0,a.a,a.Ya);var c=this.oD(),d=c.eu,e=c.qs,f=c.ft,c=c.zt,c=c>f?c-f:64+c-f,g=a.rp,i=Math.cos(a.pitch),k=Math.cos(a.heading),l=Math.sin(a.heading),m=a.za*Math.sin(a.pitch),n=a.za*i*l;a.aq=-a.za*i*k;a.bq=m;a.cq=n;a.Wr=k;a.Ot=l;i=a.Mp;for(k=0;k<c;k++)for(l=d;l<e;l++){var u=k+f;63<u?u%=64:0>u&&(u+=64);var m=Math.floor(u/g),n=Math.floor(l/g),u=u%g,v=l%g,x={nb:{x:u*b,y:v*b-i},ob:{x:u*b-i,y:v* b+b+i},pb:{x:u*b+b+i,y:v*b+b}},y={nb:{x:u*b-i,y:v*b},ob:{x:u*b+b+i,y:v*b-i},pb:{x:u*b+b,y:v*b+b+i}};if(0==u)var C=-1;else u==g-1&&(C=1);if(0==v)var A=-1;else v==g-1&&(A=1);this.MC(x,m,n,a.zoom,C,A);this.NC(y,m,n,a.zoom,C,A)}}},aR:function(){var a=this.qa;this.pg.clearRect(0,0,a.a,a.Ya);var b=a.Mp,c=Math.cos(a.pitch),d=Math.cos(a.heading),e=Math.sin(a.heading),f=a.za*Math.sin(a.pitch),g=a.za*c*e;a.aq=-a.za*c*d;a.bq=f;a.cq=g;a.Wr=d;a.Ot=e;for(a=0;16>a;a++)for(c=0;16>c;c++){d={nb:{x:32*a,y:32*c-b},ob:{x:32* a-b,y:32*c+32+b},pb:{x:32*a+32+b,y:32*c+32}};e={nb:{x:32*a-b,y:32*c},ob:{x:32*a+32+b,y:32*c-b},pb:{x:32*a+32,y:32*c+32+b}};if(0==a)var i=-1;else 15==a&&(i=1);if(0==c)var k=-1;else 15==c&&(k=1);this.pK(d,0,2,i,k);this.qK(e,0,2,i,k);this.pK(d,1,2,i,k);this.qK(e,1,2,i,k)}},rD:function(a,b){var c=this.qa,d=a-c.a/2,e=c.Ya/2-b,f=c.pitch+c.Tr/180*Math.PI,g=c.heading-c.Mf/180*Math.PI,i=-c.za*Math.cos(f)*Math.cos(g),k=c.za*Math.sin(f),l=c.za*Math.cos(f)*Math.sin(g),m=d*Math.sin(g),d=d*Math.cos(g),n=e*Math.sin(f)* Math.cos(g),e=e*Math.cos(f),i=i+m+n,k=k+e,e=l+d+-e*Math.sin(f)*Math.sin(g),f=this.Ca(i,k,e);if(2<k)return q;g=2.08/(2.08-k);i*=g;e*=g;return{jG:i,kG:e,za:Math.sqrt(Math.pow(i,2)+Math.pow(e,2)),VE:c.za,heading:f.heading}},oD:function(a){var b=this.qa;a&&(b.heading=(a.heading+b.Mf)/180*Math.PI,b.heading>2*Math.PI?b.heading-=2*Math.PI:0>b.heading&&(b.heading+=2*Math.PI),b.pitch=a.pitch/180*Math.PI-b.Tr/180*Math.PI);var c=Math.cos(b.pitch),d=Math.sin(b.pitch),e=Math.cos(b.heading),f=Math.sin(b.heading), a=-b.za*c*e,g=b.za*d,i=b.za*c*f,k=b.Ya/2*d*e,l=b.Ya/2*c,m=-b.Ya/2*d*f,n=-b.Ya/2*d*e,c=-b.Ya/2*c,d=b.Ya/2*d*f,u=-b.a/2*f,v=-b.a/2*e,f=b.a/2*f,e=b.a/2*e;if(0<b.pitch)var x=this.Ca(a+k+u,g+l+0,i+m+v),y=this.Ca(a+n,g+c,i+d),C=this.Ca(a+n+f,g+c+0,i+d+e);else var A=a+k,D=g+l,m=i+m,B=this.Ca(A,D,m),D=this.Ca(A+u,D+0,m+v),A=this.Ca(a+n+f,g+c+0,i+d+e);a=Math.atan(b.Ya/2/b.za);b.pitch+a>Math.PI/2?(B=0,y=y.pitch<C.pitch?y.pitch:C.pitch,y=Math.ceil(32*(Math.PI/2-y)/Math.PI)):b.pitch-a<-Math.PI/2?(y=B.pitch>D.pitch? B.pitch:D.pitch,B=Math.floor(32*(Math.PI/2-y)/Math.PI),y=32):0<b.pitch?(B=Math.floor(32*(Math.PI/2-b.pitch-a)/Math.PI),y=y.pitch>C.pitch?C.pitch:y.pitch,y=Math.ceil(32*(Math.PI/2-y)/Math.PI)):(y=B.pitch>D.pitch?B.pitch:D.pitch,B=Math.floor(32*(Math.PI/2-y)/Math.PI),y=Math.ceil(32*(Math.PI/2-b.pitch+a)/Math.PI));Math.abs(b.pitch)>=Math.PI/2-a?(A=0,x=64):0<b.pitch?(A=Math.floor(32*x.heading/Math.PI),x=b.heading>x.heading?Math.ceil(32*(2*b.heading-x.heading)/Math.PI):Math.ceil(32*(2*b.heading+2*Math.PI- x.heading)/Math.PI)):(x=Math.ceil(32*A.heading/Math.PI),A=b.heading>A.heading?Math.floor(32*(2*b.heading-2*Math.PI-A.heading)/Math.PI):Math.floor(32*(2*b.heading-A.heading)/Math.PI));0>A&&(A+=64);64<x&&(x-=64);32<y&&(y=32);0>B&&(B=0);b.bound={eu:B,qs:y,ft:A,zt:x};return{eu:B,qs:y,ft:A,zt:x}},MC:function(a,b,c,d,e,f){if(2==this.si[b][c].fm){var g=this.pg,i=0,k=0,l=0,m=0,n=this.qa.Pp;e&&(1==e?k=n:-1==e&&(i=n));f&&(-1==f?l=n:1==f&&(m=n));e=this.qa.Nm;l=this.ig(a.nb,b,c,d,0,-i,e,l);if(!l)return q;i=this.ig(a.ob, b,c,d,-e,-i,-e,-m);if(!i)return q;d=this.ig(a.pb,b,c,d,e,k,0,-m);if(!d)return q;d={nb:l,ob:i,pb:d};k=d.nb;m=d.ob;i=d.pb;g.save();g.beginPath();g.moveTo(k.x,k.y);g.lineTo(m.x,m.y);g.lineTo(i.x,i.y);g.closePath();g.clip();a=this.tk(a,d);g.transform(a[0],a[1],a[2],a[3],a[4],a[5]);g.drawImage(this.si[b][c].qe,0,0)}else{g=this.pg;m=l=k=i=0;n=0.0078125;e&&(1==e?k=n:-1==e&&(i=n));f&&(-1==f?l=n:1==f&&(m=n));e=0.0078125;l=this.ig(a.nb,b,c,d,0,-i,e,l);if(!l)return q;i=this.ig(a.ob,b,c,d,-e,-i,-e,-m);if(!i)return q; d=this.ig(a.pb,b,c,d,e,k,0,-m);if(!d)return q;d={nb:l,ob:i,pb:d};k=d.nb;m=d.ob;i=d.pb;g.save();g.beginPath();g.moveTo(k.x,k.y);g.lineTo(m.x,m.y);g.lineTo(i.x,i.y);g.closePath();g.clip();k=a.nb;m=a.ob;i=a.pb;l=this.qa.Rm;e=512*b;c*=512;b>=l?(a.nb={x:(e+k.x)/l-512,y:(c+k.y)/l},a.ob={x:(e+m.x)/l-512,y:(c+m.y)/l},a.pb={x:(e+i.x)/l-512,y:(c+i.y)/l},a=this.tk(a,d),g.transform(a[0],a[1],a[2],a[3],a[4],a[5]),g.drawImage(this.Ck[1],0,0)):(a.nb={x:(e+k.x)/l,y:(c+k.y)/l},a.ob={x:(e+m.x)/l,y:(c+m.y)/l},a.pb= {x:(e+i.x)/l,y:(c+i.y)/l},a=this.tk(a,d),g.transform(a[0],a[1],a[2],a[3],a[4],a[5]),g.drawImage(this.Ck[0],0,0))}g.restore()},NC:function(a,b,c,d,e,f){if(2==this.si[b][c].fm){var g=this.pg,i=0,k=0,l=0,m=0,n=this.qa.Pp;e&&(1==e?k=n:-1==e&&(i=n));f&&(-1==f?l=n:1==f&&(m=n));e=this.qa.Nm;i=this.ig(a.nb,b,c,d,-e,-i,0,l);if(!i)return q;l=this.ig(a.ob,b,c,d,e,k,e,l);if(!l)return q;d=this.ig(a.pb,b,c,d,0,k,-e,-m);if(!d)return q;d={nb:i,ob:l,pb:d};k=d.nb;m=d.ob;l=d.pb;g.save();g.beginPath();g.moveTo(k.x,k.y); g.lineTo(m.x,m.y);g.lineTo(l.x,l.y);g.closePath();g.clip();a=this.tk(a,d);g.transform(a[0],a[1],a[2],a[3],a[4],a[5]);g.drawImage(this.si[b][c].qe,0,0)}else{g=this.pg;m=l=k=i=0;n=0.0078125;e&&(1==e?k=n:-1==e&&(i=n));f&&(-1==f?l=n:1==f&&(m=n));e=0.0078125;i=this.ig(a.nb,b,c,d,-e,-i,0,l);if(!i)return q;l=this.ig(a.ob,b,c,d,e,k,e,l);if(!l)return q;d=this.ig(a.pb,b,c,d,0,k,-e,-m);if(!d)return q;d={nb:i,ob:l,pb:d};k=d.nb;m=d.ob;l=d.pb;g.save();g.beginPath();g.moveTo(k.x,k.y);g.lineTo(m.x,m.y);g.lineTo(l.x, l.y);g.closePath();g.clip();k=a.nb;m=a.ob;l=a.pb;i=this.qa.Rm;e=512*b;c*=512;b>=i?(a.nb={x:(e+k.x)/i-512,y:(c+k.y)/i},a.ob={x:(e+m.x)/i-512,y:(c+m.y)/i},a.pb={x:(e+l.x)/i-512,y:(c+l.y)/i},a=this.tk(a,d),g.transform(a[0],a[1],a[2],a[3],a[4],a[5]),g.drawImage(this.Ck[1],0,0)):(a.nb={x:(e+k.x)/i,y:(c+k.y)/i},a.ob={x:(e+m.x)/i,y:(c+m.y)/i},a.pb={x:(e+l.x)/i,y:(c+l.y)/i},a=this.tk(a,d),g.transform(a[0],a[1],a[2],a[3],a[4],a[5]),g.drawImage(this.Ck[0],0,0))}g.restore()},ig:function(a,b,c,d,e,f,g,i){d=this.qa; b=2*(1/d.wt*a.x/512+b/d.wt)*Math.PI;c=(0.5-1/d.Rm*a.y/512-c/d.Rm)*Math.PI;a=Math.sin(Math.abs(c));0.4>a?a=0.4:0.98<a&&(a=d.vt);var b=b+(e+f)*a,c=c+(g+i)*a,k=d.za,e=Math.cos(c),a=-e*Math.cos(b),c=Math.sin(c),l=e*Math.sin(b),b=d.Wr,e=d.Ot,f=d.aq,g=d.bq,i=d.cq,m=f*a+c*g+l*i;if(0>m)return q;k=k*k/m;a=k*a-f;c=k*c-g;l=k*l-i;m=Math.pow(a,2)+Math.pow(c,2)+Math.pow(l,2);k=Math.sqrt(m);0==m?e=b=0:(m=(a*e+l*b)/k,1<m?m=1:-1>m&&(m=-1),m=Math.acos(m),0>a*b*g+c*e*i-c*b*f-l*g*e&&(m=2*Math.PI-m),b=k*Math.cos(m),e= k*Math.sin(m));return{x:d.a/2+b,y:d.Ya/2-e}},aX:function(a){var b=this.M.ga();if(b){var c=this.qa,d=c.heading,e=c.za,f=c.pitch+c.Tr/180*Math.PI,d=d-c.Mf/180*Math.PI,g=6378137*-(a.lat-b.lat)/180*Math.PI,i=6378137*(a.lng-b.lng)/180*Math.PI,a=Math.sqrt(Math.pow(g,2)+Math.pow(i,2)),k=Math.cos(f),b=Math.cos(d),d=Math.sin(d),l=-e*k*b,f=e*Math.sin(f),k=e*k*d,m=l*g+-2.08*f+i*k;if(0>m)return q;var m=e*e/m,g=m*g-l,e=-2.08*m-f,m=m*i-k,n=Math.pow(g,2)+Math.pow(e,2)+Math.pow(m,2),i=Math.sqrt(n);0==n?d=b=0:(n= (g*d+m*b)/i,1<n?n=1:-1>n&&(n=-1),n=Math.acos(n),0>g*b*f+e*d*k-e*b*l-m*f*d&&(n=2*Math.PI-n),b=i*Math.cos(n),d=i*Math.sin(n));return{x:c.a/2+b,y:c.Ya/2-d,za:a}}return q},Ca:function(a,b,c){var d=Math.pow(a,2),e=Math.pow(c,2);return{heading:0<c?Math.PI-Math.acos(a/Math.sqrt(d+e)):Math.PI+Math.acos(a/Math.sqrt(d+e)),pitch:Math.asin(b/Math.sqrt(d+Math.pow(b,2)+e))}},tk:function(a,b){var c=a.nb.x,d=a.nb.y,e=a.ob.y,f=a.pb.y,g=b.nb.x,i=b.nb.y,k=b.ob.x,l=b.ob.y,m=b.pb.x,n=b.pb.y,u=e-d,v=f-d,x=a.ob.x-c,y=a.pb.x- c,u=e-d,v=f-d,e=m-g,l=l-i,k=k-g,n=n-i,f=y*u-x*v,u=[(e*u-k*v)/f,(n*u-l*v)/f,(e*x-k*y)/-f,(l*y-n*x)/f];u[4]=g-u[0]*c-u[2]*d;u[5]=i-u[3]*d-u[1]*c;return u}});function ui(a){this.M=a;this.Wa=this.da=p;this.jv=0;this.Vh=a.Vh;this.eA=new si;this.Ug={};this.eo={};this.Ao={Zh:0.0010,width:0,height:0,heading:0,pitch:0};this.M.qa=this;this.PG=0;this.Nd={};this.ba()} w.extend(ui.prototype,{ba:function(){var a=this,b=a.M;b.addEventListener("size_changed",function(){a.Nd={}});b.addEventListener("zoom_changed_inner",function(){a.Nd={}})},setData:function(a){if(!this.da||!(a&&a.id==this.da.id))a?(this.hp(),this.xl=this.da?this.da.id:p,this.TA=this.da?this.da.tiles.dirNorth:p,this.mI=this.aA||p):this.TA=this.xl=p,this.XI=q,this.Nd={},this.da=a,this.aA=this.M.Ca().heading},hp:function(){if(Rd()){var a=this.M.Gv.style,b=this.M.Hv.style;a.gc=a.WebkitTransition="";b.gc= b.WebkitTransition="";a.visibility=b.visibility="hidden";a.opacity=b.opacity="0"}for(var c in this.Ug)this.eo[c]=this.Ug[c],this.eo[c].style.zIndex="0"},ta:function(a,b,c){if(this.da){var d=a.heading,e=a.pitch,f=this.M,g,i,k,l,m,n;this.Nd[this.da.id]?(f=this.Nd[this.da.id],i=f.Mf,k=f.eO,l=f.gO,m=f.hK,g=f.Zh,n=f.dC,f=f.cC):(g=this.da.tiles,i=g.dirNorth,n=f.La().clientWidth,f=f.La().clientHeight,k=g.Yo(b),l=g.lx(b),m=360/k,g=360/(k*c),this.Nd[this.da.id]={Mf:i,eO:k,gO:l,hK:m,Zh:g,dC:n,cC:f},this.WP()); this.mI=this.aA||p;this.aA=d;Rd()&&this.XT(d,e,b,c,g,n,f,i,k,l);this.Vg=c;i+=d;k=90-e;var e=Math.floor(i/m),d=Math.floor(k/m),u=n/2;i=Math.round(u-i%m/g);0>e&&(i-=c);k=Math.round(f/2-k%m/g);var v,x;this.TA&&(v=this.TA+this.mI,x=Math.round(u-v%m/g),v=Math.floor(v/m));v&&0>v&&(x-=c);m=d-Math.ceil(k/c);u=d+Math.ceil((f-k-c)/c);m=0>m?0:m;var u=u>l-1?l-1:u,y=e+Math.ceil((n-i-c)/c);l=[];for(var C={},c=e-Math.ceil(i/c);c<=y;c++)for(var A=m;A<=u;A++)l.push([c,A]),C[this.qq(this.da.id,c,A,b)]=o;for(D in this.Ug)if(!C[D]&& !this.eo[D]&&(c=this.Ug[D]))c.style.display="none";this.jv+=l.length;l.sort(function(a){return function(b,c){return 0.4*Math.abs(b[0]-a[0])+0.6*Math.abs(b[1]-a[1])-(0.4*Math.abs(c[0]-a[0])+0.6*Math.abs(c[1]-a[1]))}}([e,d]));for(c=0;c<l.length;c++)this.YT(l[c][0],l[c][1],b,e,d,i,k,v,x);this.Ao.Zh=g;this.Ao.width=n;this.Ao.height=f;this.Ao.heading=a.heading;this.Ao.pitch=a.pitch}else{for(var D in this.Ug)(c=this.Ug[D])&&c.parentNode&&c.parentNode.removeChild(c),delete this.Ug[D];Rd()&&(a=this.M.Gv, b=this.M.Hv,a&&(a.src=b.src="",a.style.visibility=b.style.visibility="hidden"))}},XT:function(a,b,c,d,e,f,g,i,k,l){var c=this.M.Gv,m=this.M.Hv,n=this,d=[k*d,l*d];if(!this.XI||d!==this.PG)this.XI=o,c.style.gc=c.style.WebkitTransition=m.style.gc=m.style.WebkitTransition="opacity 300ms ease-out",c.style.width=m.style.width=d[0]+"px",c.style.height=m.style.height=d[1]+"px",c.style.JU=m.style.JU=d[0]+"px, "+d[1]+"px",c.style.left=Math.round((0-i-a)/e+f/2)+"px",m.style.left=parseInt(c.style.left)+d[0]+ "px",c.onload=function(){-1!=this.src.indexOf("pos=0_0&z=1")&&n.M.dispatchEvent(new N("onthumbnail_complete"))},k="http://pcsv0.map.bdimg.com/scape/?qt=pdata&sid="+this.da.id+"&pos=0_0&z=1",c.src!=k&&(c.src=m.src=k);this.PG=d;a=Math.round((0-i-a)%360/e+f/2);c.style.top=m.style.top=Math.round(-(90-b)/e+g/2)+"px";0<a&&0>a-d[0]?(c.style.left=a+"px",m.style.left=parseInt(c.style.left)-d[0]+"px"):0<=a-d[0]?(m.style.left=a-d[0]+"px",c.style.left=parseInt(m.style.left)-d[0]+"px"):a+d[0]<f&&0<=a+d[0]?(c.style.left= a+"px",m.style.left=parseInt(c.style.left)+d[0]+"px"):0>a+d[0]?(m.style.left=a+d[0]+"px",c.style.left=parseInt(m.style.left)+d[0]+"px"):(c.style.left=a+"px",m.style.left=a+d[0]+"px")},YT:function(a,b,c,d,e,f,g,i,k){var l=this.da.tiles,m=this.Vg,n=l.Yo(c),u=this.eo[this.qq(this.xl,a,b,c)];u&&(u=u.style,u.top=Math.round((b-e)*m+g)+"px",u.left=Math.round((a-(i||d))*m+(k||f))+"px",u.width=u.height=Math.ceil(m)+"px");var i=this.qq(this.da.id,a,b,c),v=this.Ug[i];if(v)l=v.style,l.top=Math.round((b-e)*m+ g)+"px",l.left=Math.round((a-d)*m+f)+"px",l.width=l.height=Math.ceil(m)+"px",l.zIndex="2",l.display="",this.vf(),v.rB.x=a,v.rB.y=b;else{v=this.eA.Ww();v.setAttribute("errorCount",0);for(k=a;0>k;)k=n+k;var x=l.getTilesUrl(this.da.id,new P((k+n)%n,b),c),y=this;v.onload=function(){y.vf();y.Vh.appendChild(this);v.style.opacity="1"};v.onerror=function(){var a=this,b=a.getAttribute("errorCount");if(b<3){b++;setTimeout(function(){a.src=x},100);a.setAttribute("errorCount",b)}else y.vf()};l=v.style;l.position= "absolute";l.zIndex="2";l.border="none";l.display="";l.WebkitUserSelect="none";l.WebkitUserDrag="none";l.width=l.height=Math.ceil(m)+"px";l.top=Math.round((b-e)*m+g)+"px";l.left=Math.round((a-d)*m+f)+"px";l.opacity="0";l.gc=l.WebkitTransition="opacity 300ms ease-out";v.src=x;0<v.width&&(l.opacity="1");v.rB={id:this.da.id,zoom:c,x:a,y:b};v.ontouchstart=function(a){a.preventDefault()};this.Ug[i]=v}},fS:function(a){var b=this.Ug[a];b&&(delete b.rB,b.onerror=b.onload=b.ontouchstart=p,b.style.display= "none");delete this.Ug[a];delete this.eo[a];b&&(b.Mz=o,b.src="")},Lc:function(a,b){var c=this.Ze;this.Ze=b;c!=this.Ze&&this.hp()},Dk:function(){this.Nd={}},vf:function(){var a=this;this.jv--;if(0==this.jv){for(var b in this.eo)(function(){var c=b;setTimeout(function(){a.fS(c)},300)})();this.M.dispatchEvent(new N("ontilesloaded"))}},qq:function(a,b,c,d){var e=this.da.tiles.Yo(d),f=(b+e)%e;0==d&&(f=(b+2*e)%(2*e));return a+"_"+f+"_"+c+"_"+d},ZW:function(a){var b=this.Ao,c=this.M.ga();if(c){var d=6378137* -(a.lat-c.lat)/180*Math.PI,e=6378137*(a.lng-c.lng)/180*Math.PI,a=Math.sqrt(Math.pow(d,2)+Math.pow(e,2)),c=b.heading%360-b.Zh*b.width/2,f=b.pitch+b.Zh*b.height/2,d=this.Ca(d,-2.08,e);return{x:(180*(d.heading%360/Math.PI)-c)/b.Zh,y:(f-180*(d.pitch/Math.PI))/b.Zh,za:a}}return q},Ca:function(a,b,c){var d=Math.pow(a,2),e=Math.pow(c,2);return{heading:0<c?Math.PI-Math.acos(a/Math.sqrt(d+e)):Math.PI+Math.acos(a/Math.sqrt(d+e)),pitch:Math.asin(b/Math.sqrt(d+Math.pow(b,2)+e))}},WP:function(){var a=this.M,b= a.eh().height/2*this.Nd[this.da.id].Zh;a.GZ(-90+b,90-b)}});function mi(a){this.M=a;a.xA=this;this.$f=[];this.AG=[];this.lq=[];this.zG=[];this.fl=[];this.BH=[];this.Fv=[];this.wE=this.fI=this.eI=this.Ku=this.Ju=0;this.$J={};this.it=this.Fx=q;Jb()?this.cf=this.Az():Kb()?(this.Va=this.xz(),this.Gh=this.Va.getContext("2d"),this.GP(),this.Qn=[]):Ib()&&(this.Qv=this.CQ());this.Wa=p;this.Gy="#549eef";this.Nd={};this.Mn=this.Qj=o;this.ba()} var xi=[[0,-11],[4,-6.5],[2,-6.5],[2,-3],[-2,-3],[-2,-6.5],[-4,-6.5]],yi=[[5,-2],[5,-12],[-5,-12],[-5,-2]],zi=[[0,-110],[40,-65],[20,-65],[20,-30],[-20,-30],[-20,-65],[-40,-65]],Ai=[[45,-20],[45,-120],[-45,-120],[-45,-20]],Bi="\\u5317 \\u4e1c\\u5317 \\u4e1c \\u4e1c\\u5357 \\u5357 \\u897f\\u5357 \\u897f \\u897f\\u5317 \\u5317".split(" "); w.extend(mi.prototype,{Az:function(){var a=L("svg",{version:"1.1",overflow:"hidden"},"http://www.w3.org/2000/svg"),b=this.M,c=b.La().clientWidth,d=b.La().clientHeight;this.cf=a;this.Ju=c;this.Ku=d;this.eI=b.La().offsetLeft||0;this.fI=b.La().offsetTop||0;this.JI(c,d);a.style.position="absolute";a.style.left="0";a.style.top="0";a.style.WebkitUserSelect=a.style.aP=a.style.MozUserSelect="none";b.Rj.appendChild(a);Jb()&&"cvsRender"==this.M.Zj&&this.AZ(a);return a},AZ:function(a){var b=this,c=L("ellipse", {fill:"white","fill-rule":"evenodd","fill-opacity":"0.4",cx:"100",cy:"100",rx:"20",ry:"20"},"http://www.w3.org/2000/svg");c.setAttribute("visibility","hidden");this.QC=c;a.appendChild(c);a=this.M.La();w.K(a,"mousedown",function(a){b.wE=(new Date).valueOf();b.hZ(a.offsetX||a.layerX||0,a.offsetY||a.layerY||0)});w.K(a,"mouseup",function(){200>(new Date).valueOf()-b.wE&&(b.Fx&&b.M.k.visible)&&b.click();b.wE=0});w.K(a,"mousemove",function(a){b.iZ(a.offsetX||a.layerX||0,a.offsetY||a.layerY||0);b.uZ(a.offsetX|| a.layerX||0,a.offsetY||a.layerY||0)});w.ca.kf?w.K(a,"mouseout",function(a){var c=a.clientX||a.pageX||0,a=a.clientY||a.pageY||0,c=c-b.eI,a=a-b.fI;(40>Math.abs(Math.abs(c-b.Ju/2)-b.Ju/2)||40>Math.abs(Math.abs(a-b.Ku/2)-b.Ku/2))&&b.QC.setAttribute("visibility","hidden")}):w.K(a,"mouseout",function(){b.QC.setAttribute("visibility","hidden")});b.M.addEventListener("hide_ellipse",function(){b.it=o});b.M.addEventListener("show_ellipse",function(){b.it=q})},xz:function(){var a=L("canvas"),b=this.M,c=b.La().clientWidth, d=b.La().clientHeight;this.Va=a;a.width=c;a.height=d;var e=a.style;e.position="absolute";e.top=e.left="0";e.width=c+"px";e.height=d+"px";e.b0="rgba(0, 0, 0, 0)";b.Rj.appendChild(a);return a},CQ:function(){var a=this.M.La(),b=a.clientWidth,a=a.clientHeight;return xb(this.M.Rj,[\'<v:group style="behavior:url(#default#VML);z-index:1;width:\',b+"px;height:"+a+\'px;position:absolute;left:0;top:0;"\',\'coordsize="\'+b+","+a+\'" \',\'coordorigin="-\'+b/2+",-"+0.75*a+\'">\',"</v:group>"].join(""))},ba:function(){var a= this,b=a.M;b.addEventListener("size_changed",function(b){b=b.size;a.ve(b.width,b.height);a.Nd={}});b.addEventListener("zoom_changed_inner",function(){a.Nd={}})},ve:function(a,b){if(Jb())this.JI(a,b);else if(Kb()){var c=this.Va;c.width=a;c.height=b;c.style.width=a+"px";c.style.height=b+"px"}},JI:function(a,b){this.cf&&(this.cf.setAttribute("width",a+"px"),this.cf.setAttribute("height",b+"px"),this.cf.setAttribute("viewBox","0 0 "+a+" "+b),this.Ju=a,this.Ku=b)},setData:ba("da"),ta:function(a,b,c,d){if(this.da){this.Ba= a;this.Ic=b;this.Vg=c;var e=(a.heading+360)%360,a=a.pitch,f=this.M,g=this.da.tiles,i,k,l;this.Nd[this.da.id]?(c=this.Nd[this.da.id],i=c.dC,k=c.cC,c=c.Zh):(i=f.La().clientWidth,k=f.La().clientHeight,l=g.Yo(b),b=g.lx(b),c=360/(l*c),this.Nd[this.da.id]={dC:i,cC:k,eO:l,gO:b,hK:360/l,Zh:c});f=f.ea()+1;f=0.75*k+1*(a/c)/f;f<k/2&&(f=k/2);k=(90-a)/200;c=10;Jb()?this.oI(this.da.id,this.da.links):Kb()?(this.Gh.clearRect(0,0,this.Va.width,this.Va.height),this.da.id!=this.Wa&&(this.Qn.length=0)):Ib()&&(c=36,this.jT(this.da.id, this.da.links));for(l=0;l<this.da.links.length;l++){var b=this.da.links[l].dir-e,b=(360+b)%360,g=i/2+50*Math.sin(Lb(b)),m=f-60*Math.cos(Lb(b))*k;if(Jb())this.NQ(l,[i/2,f],[c,c*k],b),this.YQ(l,[g,m]);else if(Kb()){var n="#444";d==l&&(n=this.Gy);this.TG([i/2,f+3],[c,c*k],b,"#000",0.4);this.TG([i/2,f],[c,c*k],b,"#fff",0.95,n);this.ZQ(l,[g,m],n);b=[i/2+60*Math.sin(Lb(b)),f-50*Math.cos(Lb(b))*k];this.Qn[l]=[Math.round(b[0]),Math.round(b[1])]}else Ib()&&(g=1,-30<a&&(g=80>a- -30?g+Math.tan(Lb(a- -30)):g+ 6),g=-Math.sin(Lb(Math.min(a,-30)))/g,this.Qv.coordorigin=Math.round(-i/2)+","+Math.round(-f+40),this.OQ(l,b,g))}}else Jb()?this.oI(p,[]):(this.Gh.clearRect(0,0,this.Va.width,this.Va.height),this.Qn.length=0)},oI:function(a,b){if(a!=this.Wa){this.Wa=a;linksCount=b.length;if(linksCount>this.$f.length){for(var c=linksCount-this.$f.length,d=this.cf,e=0;e<c;e++){var f=L("path",{fill:"black","fill-rule":"evenodd","fill-opacity":"0.4",stroke:"none"},"http://www.w3.org/2000/svg"),g=L("path",{fill:"white", "fill-rule":"evenodd","fill-opacity":"0.9",stroke:"#444","stroke-width":"0.2","stroke-linecap":"round"},"http://www.w3.org/2000/svg"),i=["M"],k=xi;i.push(k[0][0]);i.push(k[0][1]);for(var l=1;l<k.length;l++)i.push("L"),i.push(k[l][0]),i.push(k[l][1]);i.push(k[0][0]);i.push(k[0][1]);f.setAttribute("d",i.join(" "));this.lq.push(f);d.appendChild(f);g.setAttribute("d",i.join(" "));this.$f.push(g);d.appendChild(g);l=L("text",{fill:"#444","fill-rule":"evenodd",stroke:"none","font-size":"16px","font-family":"arial", "text-anchor":"middle","alignment-baseline":"middle"},"http://www.w3.org/2000/svg");l.style.WebkitUserSelect=l.style.aP=l.style.MozUserSelect="none";this.Fv.push(l);d.appendChild(l);var f=L("path",{fill:"white","fill-rule":"evenodd","fill-opacity":"0",stroke:"none",cursor:"pointer"},"http://www.w3.org/2000/svg"),m=this;f.xG=g;f.WI=l;f.style.MozUserSelect="none";g=["M"];i=yi;g.push(i[0][0]);g.push(i[0][1]);for(l=1;l<i.length;l++)g.push("L"),g.push(i[l][0]),g.push(i[l][1]);f.setAttribute("d",g.join(" ")); w.K(f,F()?"touchstart":"mousedown",function(a){m.io={heading:m.Ba.heading,pitch:m.Ba.pitch};m.xq=this;this.xG.setAttribute("stroke",m.Gy);this.WI.setAttribute("fill",m.Gy);zb(a)});this.fl.push(f);d.appendChild(f);w.K(f,"mousemove",function(){m.it=o});w.K(f,"mouseout",function(){m.it=q})}w.K(this.M.z,F()?"touchend":"mouseup",function(a){if(m.xq){if(m.Ba.heading==m.io.heading&&m.Ba.pitch==m.io.pitch){var b=m.xq.getAttribute("sid");b&&(m.M.dispatchEvent(new N("onlinkclick")),m.M.pc(b));m.I0=m.J0=p}m.xq.xG.setAttribute("stroke", "#444");m.xq.WI.setAttribute("fill","#444");m.io=p;m.xq=p;a.stopPropagation()}})}for(e=0;e<this.$f.length;e++)c="",e<linksCount?(d=this.Fv[e],0<d.childNodes.length&&d.removeChild(d.childNodes[0]),l=this.kH(b[e].dir),d.appendChild(document.createTextNode(l)),this.fl[e].setAttribute("sid",b[e].id)):c="none",this.$f[e].style.display=c,this.lq[e].style.display=c,this.Fv[e].style.display=c,this.fl[e].style.display=c}},GP:function(){var a=this,b=a.M;w.K(this.Va,"touchstart",function(b){a.io={heading:a.Ba.heading, pitch:a.Ba.pitch};var d=yb(a.Va);a.Zu=a.$K(b.touches[0].clientX-d.left,b.touches[0].clientY-d.top);a.ta(a.Ba,a.Ic,a.Vg,a.Zu)});w.K(this.Va,"touchend",function(){a.Ba.heading==a.io.heading&&a.Ba.pitch==a.io.pitch&&a.da.links[a.Zu]&&(b.dispatchEvent(new N("onlinkclick")),b.pc(a.da.links[a.Zu].id));a.Zu=p})},$K:function(a,b){for(var c=0;c<this.Qn.length;c++)if(30>Math.abs(a-this.Qn[c][0])&&30>Math.abs(b-this.Qn[c][1]))return c;return-1},jT:function(a,b){if(a!=this.Wa){this.Wa=a;linksCount=b.length;if(linksCount> this.$f.length)for(var c=linksCount-this.$f.length,d=0;d<c;d++){for(var e=[],f=zi,g=0;g<f.length;g++)e.push(f[g][0]),e.push(f[g][1]);e.push(f[0][0]);e.push(f[0][1]);g=xb(this.Qv,["<v:polyline ",\'points="\'+e.join(" ")+\'"\',\' style="behavior:url(#default#VML);z-index:1;left:0;top:0;" stroked="false"><v:fill style="behavior:url(#default#VML)" color="black" opacity="0.5"></v:fill><v:skew style="behavior:url(#default#VML)" on="true" origin="0,1.5" matrix="1,0,0,1,0,0" offset="0,0.05"></v:skew></v:polyline>\'].join("")); this.lq.push(g);this.zG.push(g.getElementsByTagName("skew")[0]);g=xb(this.Qv,["<v:polyline ",\'points="\'+e.join(" ")+\'"\',\'fillcolor="white" stroked="true" strokecolor="#444" strokeweight="1"  style="behavior:url(#default#VML);z-index:2;left:0;top:0;"><v:fill style="behavior:url(#default#VML)" color="white" opacity="1"></v:fill><v:skew style="behavior:url(#default#VML)" on="true" origin="0,1.5" matrix="1,0,0,1,0,0" offset="0,0"></v:skew></v:polyline>\'].join(""));this.$f.push(g);this.AG.push(g.getElementsByTagName("skew")[0]); e=[];f=Ai;for(g=0;g<f.length;g++)e.push(f[g][0]),e.push(f[g][1]);var g=xb(this.Qv,[\'<v:polyline style="cursor:pointer;z-index:3;behavior:url(#default#VML);"\',\' points="\'+e.join(" ")+\'" stroked="false">\',\'<v:fill style="behavior:url(#default#VML);" color="white" opacity="0"></v:fill><v:skew style="behavior:url(#default#VML);" on="true" origin="0,1.2" matrix="1,0,0,1,0,0"></v:skew></v:polyline>\'].join("")),i=this;w.K(g,"click",function(a){(a=a.srcElement.sid)&&i.M.pc(a)});this.fl.push(g);this.BH.push(g.getElementsByTagName("skew")[0])}for(d= 0;d<this.$f.length;d++)c="",d<linksCount?this.fl[d].sid=b[d].id:c="none",this.$f[d].style.display=c,this.lq[d].style.display=c,this.fl[d].style.display=c}},NQ:function(a,b,c,d){this.$f[a]&&(this.$f[a].setAttribute("transform","translate("+b[0]+" "+b[1]+")scale("+c[0]+" "+c[1]+")rotate("+d+")"),this.lq[a].setAttribute("transform","translate("+b[0]+" "+(b[1]+4)+")scale("+c[0]+" "+c[1]+")rotate("+d+")"),this.fl[a].setAttribute("transform","translate("+b[0]+" "+b[1]+")scale("+c[0]+" "+c[1]+")rotate("+ d+")"))},YQ:function(a,b){this.Fv[a].setAttribute("transform","translate("+b[0]+" "+b[1]+")")},OQ:function(a,b,c){this.$y(this.AG[a],b,0,c);this.$y(this.zG[a],b,0.6,c);this.$y(this.BH[a],b,0,c)},$y:function(a,b,c,d){var e=Lb(b),b=Math.cos(e),e=Math.sin(e);a.matrix=[Number(b).toFixed(4),Number(-e).toFixed(4),Number(e*d).toFixed(4),Number(b*d).toFixed(4),0,0].join();a.offset="0,"+Math.round(50*c)/1E3},TG:function(a,b,c,d,e,f){var g=this.Gh;g.save();g.fillStyle=d;g.globalAlpha=e;g.translate(a[0],a[1]); g.scale(b[0],b[1]);g.rotate(Lb(c));g.beginPath();g.moveTo(xi[0][0],xi[0][1]);for(a=1;a<xi.length;a++)g.lineTo(xi[a][0],xi[a][1]);g.closePath();g.fill();f&&(g.lineWidth="0.2",g.lineCap="round",g.lineJoin="round",g.strokeStyle=f,g.stroke());g.restore()},ZQ:function(a,b,c){var d=this.Gh;d.save();a=this.kH(this.da.links[a].dir);d.font="16px sans-serif";d.textAlign="center";d.textBaseline="middle";d.fillStyle=c;d.fillText(a,b[0],b[1]);d.restore()},kH:function(a){return Bi[Math.ceil(Math.floor((a+360)% 360/22.5)/2)]},qL:ca(0),click:function(){if(!(2<Math.abs(this.VV-this.qY)||2<Math.abs(this.nK-this.nK))){var a=this.$J;if(a){for(var b=this.da.links,c=this.LW(a.jG,a.kG),d=30,e=0,f=0;f<b.length;f++)e=b[f].dir-c,e=180<Math.abs(e)?b[f].dir>c?360+c-b[f].dir:360-c+b[f].dir:Math.abs(e),e<d&&(d=e);29>d&&(b=this.M.ga(),this.M.ra(new H(b.lng+180*a.kG/Math.PI/6378137,b.lat-180*a.jG/Math.PI/6378137)))}}},hZ:function(a,b){this.VV=a;this.nK=b},iZ:ba("qY"),uZ:function(a,b){this.$J=coord=this.M.qa.rD(a,b);var c= this.QC;if(coord&&!this.it&&this.M.k.visible){c.setAttribute("cx",a);c.setAttribute("cy",b);var d=Math.abs(2*coord.VE/(coord.za-2)-2*coord.VE/(coord.za+2))/2,e=2*coord.VE/coord.za;if(4<coord.za){if(100<e){var f=e/100,e=100,d=d/f;d>e&&(d=e)}c.setAttribute("rx",e);c.setAttribute("ry",d);c.setAttribute("visibility","visible");this.Fx=o}else this.Fx=q,c.setAttribute("visibility","hidden")}else this.Fx=q,c.setAttribute("visibility","hidden")},LW:function(a,b){var c=0;0<a?c=180*(Math.atan(b/a)/Math.PI): 0>a?c=180*(Math.atan(b/a)/Math.PI)+180:0==a&&(c=0<b?90:-90);heading=180-c;360<heading?heading-=360:0>heading&&(heading+=360);return heading},R:function(){this.Qj=q;this.M.Rj&&(this.M.Rj.style.visibility="hidden")},show:function(){this.Qj=o;this.M.Rj&&(this.M.Rj.style.visibility="visible")},RC:function(){this.Mn=o},wC:function(){this.Mn=q}});var Ci={get:function(a,b){var c="inst_"+b;Ci[c]||(Ci[c]=new Di(a));return Ci[c]}};function Di(a){this.eb=a;this.yu=new Uint8Array(16);this.Gq=new Uint8Array(16)}w.extend(Di.prototype,{VD:function(){for(var a=0,b=this.yu.length;a<b;a++)this.yu[a]=0},Go:function(a){this.yu[a]=1;0===this.Gq[a]&&(this.eb.enableVertexAttribArray(a),this.Gq[a]=1)},zC:function(){for(var a=0,b=this.Gq.length;a<b;a++)this.Gq[a]!==this.yu[a]&&(this.eb.disableVertexAttribArray(a),this.Gq[a]=0)}});if(!Ei)var Ei=1.0E-6;if(!Fi)var Fi="undefined"!==typeof Float32Array?Float32Array:Array;if(!Gi)var Gi=Math.random;var Hi={B3:function(a){Fi=a}};"undefined"!==typeof exports&&(exports.p2=Hi);var Ii=Math.PI/180;Hi.L3=function(a){return a*Ii}; var Ji={create:function(){var a=new Fi(2);a[0]=0;a[1]=0;return a},bi:function(a){var b=new Fi(2);b[0]=a[0];b[1]=a[1];return b},rg:function(a,b){var c=new Fi(2);c[0]=a;c[1]=b;return c},copy:function(a,b){a[0]=b[0];a[1]=b[1];return a},set:function(a,b,c){a[0]=b;a[1]=c;return a},add:function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];return a},Vt:function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];return a}};Ji.sub=Ji.Vt;Ji.multiply=function(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];return a};Ji.Lm=Ji.multiply; Ji.ks=function(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];return a};Ji.lK=Ji.ks;Ji.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);return a};Ji.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);return a};Ji.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;return a};Ji.vN=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;return a};Ji.jd=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)};Ji.za=Ji.jd; Ji.St=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d};Ji.ON=Ji.St;Ji.length=function(a){var b=a[0],a=a[1];return Math.sqrt(b*b+a*a)};Ji.mE=Ji.length;Ji.Lk=function(a){var b=a[0],a=a[1];return b*b+a*a};Ji.pF=Ji.Lk;Ji.FM=function(a,b){a[0]=-b[0];a[1]=-b[1];return a};Ji.normalize=function(a,b){var c=b[0],d=b[1],c=c*c+d*d;if(c>0){c=1/Math.sqrt(c);a[0]=b[0]*c;a[1]=b[1]*c}return a};Ji.os=function(a,b){return a[0]*b[0]+a[1]*b[1]};Ji.zw=function(a,b,c){b=b[0]*c[1]-b[1]*c[0];a[0]=a[1]=0;a[2]=b;return a}; Ji.Cx=function(a,b,c,d){var e=b[0],b=b[1];a[0]=e+d*(c[0]-e);a[1]=b+d*(c[1]-b);return a};Ji.random=function(a,b){var b=b||1,c=Gi()*2*Math.PI;a[0]=Math.cos(c)*b;a[1]=Math.sin(c)*b;return a};Ji.R3=function(a,b,c){var d=b[0],b=b[1];a[0]=c[0]*d+c[2]*b;a[1]=c[1]*d+c[3]*b;return a};Ji.S3=function(a,b,c){var d=b[0],b=b[1];a[0]=c[0]*d+c[2]*b+c[4];a[1]=c[1]*d+c[3]*b+c[5];return a};Ji.u_=function(a,b,c){var d=b[0],b=b[1];a[0]=c[0]*d+c[3]*b+c[6];a[1]=c[1]*d+c[4]*b+c[7];return a}; Ji.iO=function(a,b,c){var d=b[0],b=b[1];a[0]=c[0]*d+c[4]*b+c[12];a[1]=c[1]*d+c[5]*b+c[13];return a};Ji.forEach=function(){var a=Ji.create();return function(b,c,d,e,f,g){c||(c=2);d||(d=0);for(e=e?Math.min(e*c+d,b.length):b.length;d<e;d=d+c){a[0]=b[d];a[1]=b[d+1];f(a,a,g);b[d]=a[0];b[d+1]=a[1]}return b}}();Ji.an=function(a){return"vec2("+a[0]+", "+a[1]+")"};"undefined"!==typeof exports&&(exports.W3=Ji); var Mi={create:function(){var a=new Fi(3);a[0]=0;a[1]=0;a[2]=0;return a},bi:function(a){var b=new Fi(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b},rg:function(a,b,c){var d=new Fi(3);d[0]=a;d[1]=b;d[2]=c;return d},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a},set:function(a,b,c,d){a[0]=b;a[1]=c;a[2]=d;return a},add:function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];return a},Vt:function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];return a}};Mi.sub=Mi.Vt; Mi.multiply=function(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];a[2]=b[2]*c[2];return a};Mi.Lm=Mi.multiply;Mi.ks=function(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];a[2]=b[2]/c[2];return a};Mi.lK=Mi.ks;Mi.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);a[2]=Math.min(b[2],c[2]);return a};Mi.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);a[2]=Math.max(b[2],c[2]);return a};Mi.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;return a}; Mi.vN=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;return a};Mi.jd=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e)};Mi.za=Mi.jd;Mi.St=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return c*c+d*d+e*e};Mi.ON=Mi.St;Mi.length=function(a){var b=a[0],c=a[1],a=a[2];return Math.sqrt(b*b+c*c+a*a)};Mi.mE=Mi.length;Mi.Lk=function(a){var b=a[0],c=a[1],a=a[2];return b*b+c*c+a*a};Mi.pF=Mi.Lk; Mi.FM=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];return a};Mi.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],c=c*c+d*d+e*e;if(c>0){c=1/Math.sqrt(c);a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c}return a};Mi.os=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};Mi.zw=function(a,b,c){var d=b[0],e=b[1],b=b[2],f=c[0],g=c[1],c=c[2];a[0]=e*c-b*g;a[1]=b*f-d*c;a[2]=d*g-e*f;return a};Mi.Cx=function(a,b,c,d){var e=b[0],f=b[1],b=b[2];a[0]=e+d*(c[0]-e);a[1]=f+d*(c[1]-f);a[2]=b+d*(c[2]-b);return a}; Mi.random=function(a,b){var b=b||1,c=Gi()*2*Math.PI,d=Gi()*2-1,e=Math.sqrt(1-d*d)*b;a[0]=Math.cos(c)*e;a[1]=Math.sin(c)*e;a[2]=d*b;return a};Mi.iO=function(a,b,c){var d=b[0],e=b[1],b=b[2];a[0]=c[0]*d+c[4]*e+c[8]*b+c[12];a[1]=c[1]*d+c[5]*e+c[9]*b+c[13];a[2]=c[2]*d+c[6]*e+c[10]*b+c[14];return a};Mi.u_=function(a,b,c){var d=b[0],e=b[1],b=b[2];a[0]=d*c[0]+e*c[3]+b*c[6];a[1]=d*c[1]+e*c[4]+b*c[7];a[2]=d*c[2]+e*c[5]+b*c[8];return a}; Mi.w_=function(a,b,c){var d=b[0],e=b[1],f=b[2],b=c[0],g=c[1],i=c[2],c=c[3],k=c*d+g*f-i*e,l=c*e+i*d-b*f,m=c*f+b*e-g*d,d=-b*d-g*e-i*f;a[0]=k*c+d*-b+l*-i-m*-g;a[1]=l*c+d*-g+m*-b-k*-i;a[2]=m*c+d*-i+k*-g-l*-b;return a};Mi.qN=function(a,b,c,d){var e=[],f=[];e[0]=b[0]-c[0];e[1]=b[1]-c[1];e[2]=b[2]-c[2];f[0]=e[0];f[1]=e[1]*Math.cos(d)-e[2]*Math.sin(d);f[2]=e[1]*Math.sin(d)+e[2]*Math.cos(d);a[0]=f[0]+c[0];a[1]=f[1]+c[1];a[2]=f[2]+c[2];return a}; Mi.rN=function(a,b,c,d){var e=[],f=[];e[0]=b[0]-c[0];e[1]=b[1]-c[1];e[2]=b[2]-c[2];f[0]=e[2]*Math.sin(d)+e[0]*Math.cos(d);f[1]=e[1];f[2]=e[2]*Math.cos(d)-e[0]*Math.sin(d);a[0]=f[0]+c[0];a[1]=f[1]+c[1];a[2]=f[2]+c[2];return a};Mi.sN=function(a,b,c,d){var e=[],f=[];e[0]=b[0]-c[0];e[1]=b[1]-c[1];e[2]=b[2]-c[2];f[0]=e[0]*Math.cos(d)-e[1]*Math.sin(d);f[1]=e[0]*Math.sin(d)+e[1]*Math.cos(d);f[2]=e[2];a[0]=f[0]+c[0];a[1]=f[1]+c[1];a[2]=f[2]+c[2];return a}; Mi.forEach=function(){var a=Mi.create();return function(b,c,d,e,f,g){c||(c=3);d||(d=0);for(e=e?Math.min(e*c+d,b.length):b.length;d<e;d=d+c){a[0]=b[d];a[1]=b[d+1];a[2]=b[d+2];f(a,a,g);b[d]=a[0];b[d+1]=a[1];b[d+2]=a[2]}return b}}();Mi.an=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};"undefined"!==typeof exports&&(exports.X3=Mi); var Y={create:function(){var a=new Fi(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a},bi:function(a){var b=new Fi(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},rg:function(a,b,c,d){var e=new Fi(4);e[0]=a;e[1]=b;e[2]=c;e[3]=d;return e},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},set:function(a,b,c,d,e){a[0]=b;a[1]=c;a[2]=d;a[3]=e;return a},add:function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];return a},Vt:function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1]; a[2]=b[2]-c[2];a[3]=b[3]-c[3];return a}};Y.sub=Y.Vt;Y.multiply=function(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];a[2]=b[2]*c[2];a[3]=b[3]*c[3];return a};Y.Lm=Y.multiply;Y.ks=function(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];a[2]=b[2]/c[2];a[3]=b[3]/c[3];return a};Y.lK=Y.ks;Y.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);a[2]=Math.min(b[2],c[2]);a[3]=Math.min(b[3],c[3]);return a}; Y.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);a[2]=Math.max(b[2],c[2]);a[3]=Math.max(b[3],c[3]);return a};Y.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;return a};Y.vN=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;a[3]=b[3]+c[3]*d;return a};Y.jd=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return Math.sqrt(c*c+d*d+e*e+f*f)};Y.za=Y.jd; Y.St=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return c*c+d*d+e*e+f*f};Y.ON=Y.St;Y.length=function(a){var b=a[0],c=a[1],d=a[2],a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)};Y.mE=Y.length;Y.Lk=function(a){var b=a[0],c=a[1],d=a[2],a=a[3];return b*b+c*c+d*d+a*a};Y.pF=Y.Lk;Y.FM=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=-b[3];return a}; Y.normalize=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],c=c*c+d*d+e*e+f*f;if(c>0){c=1/Math.sqrt(c);a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c}return a};Y.os=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};Y.Cx=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],b=b[3];a[0]=e+d*(c[0]-e);a[1]=f+d*(c[1]-f);a[2]=g+d*(c[2]-g);a[3]=b+d*(c[3]-b);return a};Y.random=function(a,b){b=b||1;a[0]=Gi();a[1]=Gi();a[2]=Gi();a[3]=Gi();Y.normalize(a,a);Y.scale(a,a,b);return a}; Y.iO=function(a,b,c){var d=b[0],e=b[1],f=b[2],b=b[3];a[0]=c[0]*d+c[4]*e+c[8]*f+c[12]*b;a[1]=c[1]*d+c[5]*e+c[9]*f+c[13]*b;a[2]=c[2]*d+c[6]*e+c[10]*f+c[14]*b;a[3]=c[3]*d+c[7]*e+c[11]*f+c[15]*b;return a};Y.w_=function(a,b,c){var d=b[0],e=b[1],f=b[2],b=c[0],g=c[1],i=c[2],c=c[3],k=c*d+g*f-i*e,l=c*e+i*d-b*f,m=c*f+b*e-g*d,d=-b*d-g*e-i*f;a[0]=k*c+d*-b+l*-i-m*-g;a[1]=l*c+d*-g+m*-b-k*-i;a[2]=m*c+d*-i+k*-g-l*-b;return a}; Y.forEach=function(){var a=Y.create();return function(b,c,d,e,f,g){c||(c=4);d||(d=0);for(e=e?Math.min(e*c+d,b.length):b.length;d<e;d=d+c){a[0]=b[d];a[1]=b[d+1];a[2]=b[d+2];a[3]=b[d+3];f(a,a,g);b[d]=a[0];b[d+1]=a[1];b[d+2]=a[2];b[d+3]=a[3]}return b}}();Y.an=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof exports&&(exports.Y3=Y); var Ni={create:function(){var a=new Fi(4);a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a},bi:function(a){var b=new Fi(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},zm:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a},kO:function(a,b){if(a===b){var c=b[1];a[1]=b[2];a[2]=c}else{a[0]=b[0];a[1]=b[2];a[2]=b[1];a[3]=b[3]}return a},ep:function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*f-e*d;if(!g)return p;g=1/g;a[0]=f*g;a[1]=-d*g;a[2]=-e*g; a[3]=c*g;return a},xJ:function(a,b){var c=b[0];a[0]=b[3];a[1]=-b[1];a[2]=-b[2];a[3]=c;return a},tC:function(a){return a[0]*a[3]-a[2]*a[1]},multiply:function(a,b,c){var d=b[0],e=b[1],f=b[2],b=b[3],g=c[0],i=c[1],k=c[2],c=c[3];a[0]=d*g+f*i;a[1]=e*g+b*i;a[2]=d*k+f*c;a[3]=e*k+b*c;return a}};Ni.Lm=Ni.multiply;Ni.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],b=b[3],g=Math.sin(c),c=Math.cos(c);a[0]=d*c+f*g;a[1]=e*c+b*g;a[2]=d*-g+f*c;a[3]=e*-g+b*c;return a}; Ni.scale=function(a,b,c){var d=b[1],e=b[2],f=b[3],g=c[0],c=c[1];a[0]=b[0]*g;a[1]=d*g;a[2]=e*c;a[3]=f*c;return a};Ni.an=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};Ni.gD=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))};Ni.X_=function(a,b,c,d){a[2]=d[2]/d[0];c[0]=d[0];c[1]=d[1];c[3]=d[3]-a[2]*c[1];return[a,b,c]};"undefined"!==typeof exports&&(exports.L2=Ni); var Oi={create:function(){var a=new Fi(6);a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a},bi:function(a){var b=new Fi(6);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a},zm:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a},ep:function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],i=b[5],k=c*f-d*e;if(!k)return p;k=1/k;a[0]=f*k;a[1]=-d*k;a[2]=-e*k;a[3]=c*k;a[4]=(e*i-f*g)*k;a[5]= (d*g-c*i)*k;return a},tC:function(a){return a[0]*a[3]-a[1]*a[2]},multiply:function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],i=b[4],b=b[5],k=c[0],l=c[1],m=c[2],n=c[3],u=c[4],c=c[5];a[0]=d*k+f*l;a[1]=e*k+g*l;a[2]=d*m+f*n;a[3]=e*m+g*n;a[4]=d*u+f*c+i;a[5]=e*u+g*c+b;return a}};Oi.Lm=Oi.multiply;Oi.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],i=b[4],b=b[5],k=Math.sin(c),c=Math.cos(c);a[0]=d*c+f*k;a[1]=e*c+g*k;a[2]=d*-k+f*c;a[3]=e*-k+g*c;a[4]=i;a[5]=b;return a}; Oi.scale=function(a,b,c){var d=b[1],e=b[2],f=b[3],g=b[4],i=b[5],k=c[0],c=c[1];a[0]=b[0]*k;a[1]=d*k;a[2]=e*c;a[3]=f*c;a[4]=g;a[5]=i;return a};Oi.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],i=b[4],b=b[5],k=c[0],c=c[1];a[0]=d;a[1]=e;a[2]=f;a[3]=g;a[4]=d*k+f*c+i;a[5]=e*k+g*c+b;return a};Oi.an=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"}; Oi.gD=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)};"undefined"!==typeof exports&&(exports.M2=Oi); var Pi={create:function(){var a=new Fi(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},z1:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[4];a[4]=b[5];a[5]=b[6];a[6]=b[8];a[7]=b[9];a[8]=b[10];return a},bi:function(a){var b=new Fi(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a},zm:function(a){a[0]= 1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},kO:function(a,b){if(a===b){var c=b[1],d=b[2],e=b[5];a[1]=b[3];a[2]=b[6];a[3]=c;a[5]=b[7];a[6]=d;a[7]=e}else{a[0]=b[0];a[1]=b[3];a[2]=b[6];a[3]=b[1];a[4]=b[4];a[5]=b[7];a[6]=b[2];a[7]=b[5];a[8]=b[8]}return a},ep:function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],i=b[5],k=b[6],l=b[7],m=b[8],n=m*g-i*l,u=-m*f+i*k,v=l*f-g*k,x=c*n+d*u+e*v;if(!x)return p;x=1/x;a[0]=n*x;a[1]=(-m*d+e*l)*x;a[2]=(i*d-e*g)*x;a[3]=u*x;a[4]=(m*c-e*k)*x;a[5]= (-i*c+e*f)*x;a[6]=v*x;a[7]=(-l*c+d*k)*x;a[8]=(g*c-d*f)*x;return a},xJ:function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],i=b[5],k=b[6],l=b[7],m=b[8];a[0]=g*m-i*l;a[1]=e*l-d*m;a[2]=d*i-e*g;a[3]=i*k-f*m;a[4]=c*m-e*k;a[5]=e*f-c*i;a[6]=f*l-g*k;a[7]=d*k-c*l;a[8]=c*g-d*f;return a},tC:function(a){var b=a[3],c=a[4],d=a[5],e=a[6],f=a[7],g=a[8];return a[0]*(g*c-d*f)+a[1]*(-g*b+d*e)+a[2]*(f*b-c*e)},multiply:function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],i=b[4],k=b[5],l=b[6],m=b[7],b=b[8],n=c[0],u=c[1],v= c[2],x=c[3],y=c[4],C=c[5],A=c[6],D=c[7],c=c[8];a[0]=n*d+u*g+v*l;a[1]=n*e+u*i+v*m;a[2]=n*f+u*k+v*b;a[3]=x*d+y*g+C*l;a[4]=x*e+y*i+C*m;a[5]=x*f+y*k+C*b;a[6]=A*d+D*g+c*l;a[7]=A*e+D*i+c*m;a[8]=A*f+D*k+c*b;return a}};Pi.Lm=Pi.multiply;Pi.translate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],i=b[4],k=b[5],l=b[6],m=b[7],b=b[8],n=c[0],c=c[1];a[0]=d;a[1]=e;a[2]=f;a[3]=g;a[4]=i;a[5]=k;a[6]=n*d+c*g+l;a[7]=n*e+c*i+m;a[8]=n*f+c*k+b;return a}; Pi.rotate=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],i=b[4],k=b[5],l=b[6],m=b[7],b=b[8],n=Math.sin(c),c=Math.cos(c);a[0]=c*d+n*g;a[1]=c*e+n*i;a[2]=c*f+n*k;a[3]=c*g-n*d;a[4]=c*i-n*e;a[5]=c*k-n*f;a[6]=l;a[7]=m;a[8]=b;return a};Pi.scale=function(a,b,c){var d=c[0],c=c[1];a[0]=d*b[0];a[1]=d*b[1];a[2]=d*b[2];a[3]=c*b[3];a[4]=c*b[4];a[5]=c*b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a};Pi.y1=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=0;a[3]=b[2];a[4]=b[3];a[5]=0;a[6]=b[4];a[7]=b[5];a[8]=1;return a}; Pi.pW=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,i=d+d,k=e+e,c=c*g,l=d*g,d=d*i,m=e*g,n=e*i,e=e*k,g=f*g,i=f*i,f=f*k;a[0]=1-d-e;a[3]=l-f;a[6]=m+i;a[1]=l+f;a[4]=1-c-e;a[7]=n-g;a[2]=m-i;a[5]=n+g;a[8]=1-c-d;return a}; Pi.P2=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],i=b[5],k=b[6],l=b[7],m=b[8],n=b[9],u=b[10],v=b[11],x=b[12],y=b[13],C=b[14],A=b[15],D=c*i-d*g,B=c*k-e*g,G=c*l-f*g,K=d*k-e*i,R=d*l-f*i,J=e*l-f*k,Z=m*y-n*x,ka=m*C-u*x,m=m*A-v*x,va=n*C-u*y,n=n*A-v*y,u=u*A-v*C,v=D*u-B*n+G*va+K*m-R*ka+J*Z;if(!v)return p;v=1/v;a[0]=(i*u-k*n+l*va)*v;a[1]=(k*m-g*u-l*ka)*v;a[2]=(g*n-i*m+l*Z)*v;a[3]=(e*n-d*u-f*va)*v;a[4]=(c*u-e*m+f*ka)*v;a[5]=(d*m-c*n-f*Z)*v;a[6]=(y*J-C*R+A*K)*v;a[7]=(C*G-x*J-A*B)*v;a[8]=(x*R-y*G+A* D)*v;return a};Pi.an=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};Pi.gD=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};"undefined"!==typeof exports&&(exports.N2=Pi); var qi={create:function(){var a=new Fi(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},bi:function(a){var b=new Fi(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9]; a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a},zm:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},kO:function(a,b){if(a===b){var c=b[1],d=b[2],e=b[3],f=b[6],g=b[7],i=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=c;a[6]=b[9];a[7]=b[13];a[8]=d;a[9]=f;a[11]=b[14];a[12]=e;a[13]=g;a[14]=i}else{a[0]=b[0];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=b[1];a[5]=b[5];a[6]=b[9];a[7]=b[13];a[8]=b[2]; a[9]=b[6];a[10]=b[10];a[11]=b[14];a[12]=b[3];a[13]=b[7];a[14]=b[11];a[15]=b[15]}return a},ep:function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],i=b[5],k=b[6],l=b[7],m=b[8],n=b[9],u=b[10],v=b[11],x=b[12],y=b[13],C=b[14],A=b[15],D=c*i-d*g,B=c*k-e*g,G=c*l-f*g,K=d*k-e*i,R=d*l-f*i,J=e*l-f*k,Z=m*y-n*x,ka=m*C-u*x,va=m*A-v*x,Na=n*C-u*y,ub=n*A-v*y,jb=u*A-v*C,Ea=D*jb-B*ub+G*Na+K*va-R*ka+J*Z;if(!Ea)return p;Ea=1/Ea;a[0]=(i*jb-k*ub+l*Na)*Ea;a[1]=(e*ub-d*jb-f*Na)*Ea;a[2]=(y*J-C*R+A*K)*Ea;a[3]=(u*R-n*J-v*K)* Ea;a[4]=(k*va-g*jb-l*ka)*Ea;a[5]=(c*jb-e*va+f*ka)*Ea;a[6]=(C*G-x*J-A*B)*Ea;a[7]=(m*J-u*G+v*B)*Ea;a[8]=(g*ub-i*va+l*Z)*Ea;a[9]=(d*va-c*ub-f*Z)*Ea;a[10]=(x*R-y*G+A*D)*Ea;a[11]=(n*G-m*R-v*D)*Ea;a[12]=(i*ka-g*Na-k*Z)*Ea;a[13]=(c*Na-d*ka+e*Z)*Ea;a[14]=(y*B-x*K-C*D)*Ea;a[15]=(m*K-n*B+u*D)*Ea;return a},xJ:function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],i=b[5],k=b[6],l=b[7],m=b[8],n=b[9],u=b[10],v=b[11],x=b[12],y=b[13],C=b[14],A=b[15];a[0]=i*(u*A-v*C)-n*(k*A-l*C)+y*(k*v-l*u);a[1]=-(d*(u*A-v*C)-n*(e* A-f*C)+y*(e*v-f*u));a[2]=d*(k*A-l*C)-i*(e*A-f*C)+y*(e*l-f*k);a[3]=-(d*(k*v-l*u)-i*(e*v-f*u)+n*(e*l-f*k));a[4]=-(g*(u*A-v*C)-m*(k*A-l*C)+x*(k*v-l*u));a[5]=c*(u*A-v*C)-m*(e*A-f*C)+x*(e*v-f*u);a[6]=-(c*(k*A-l*C)-g*(e*A-f*C)+x*(e*l-f*k));a[7]=c*(k*v-l*u)-g*(e*v-f*u)+m*(e*l-f*k);a[8]=g*(n*A-v*y)-m*(i*A-l*y)+x*(i*v-l*n);a[9]=-(c*(n*A-v*y)-m*(d*A-f*y)+x*(d*v-f*n));a[10]=c*(i*A-l*y)-g*(d*A-f*y)+x*(d*l-f*i);a[11]=-(c*(i*v-l*n)-g*(d*v-f*n)+m*(d*l-f*i));a[12]=-(g*(n*C-u*y)-m*(i*C-k*y)+x*(i*u-k*n));a[13]=c*(n* C-u*y)-m*(d*C-e*y)+x*(d*u-e*n);a[14]=-(c*(i*C-k*y)-g*(d*C-e*y)+x*(d*k-e*i));a[15]=c*(i*u-k*n)-g*(d*u-e*n)+m*(d*k-e*i);return a},tC:function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],i=a[6],k=a[7],l=a[8],m=a[9],n=a[10],u=a[11],v=a[12],x=a[13],y=a[14],a=a[15];return(b*g-c*f)*(n*a-u*y)-(b*i-d*f)*(m*a-u*x)+(b*k-e*f)*(m*y-n*x)+(c*i-d*g)*(l*a-u*v)-(c*k-e*g)*(l*y-n*v)+(d*k-e*i)*(l*x-m*v)},multiply:function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],i=b[4],k=b[5],l=b[6],m=b[7],n=b[8],u=b[9],v=b[10],x= b[11],y=b[12],C=b[13],A=b[14],b=b[15],D=c[0],B=c[1],G=c[2],K=c[3];a[0]=D*d+B*i+G*n+K*y;a[1]=D*e+B*k+G*u+K*C;a[2]=D*f+B*l+G*v+K*A;a[3]=D*g+B*m+G*x+K*b;D=c[4];B=c[5];G=c[6];K=c[7];a[4]=D*d+B*i+G*n+K*y;a[5]=D*e+B*k+G*u+K*C;a[6]=D*f+B*l+G*v+K*A;a[7]=D*g+B*m+G*x+K*b;D=c[8];B=c[9];G=c[10];K=c[11];a[8]=D*d+B*i+G*n+K*y;a[9]=D*e+B*k+G*u+K*C;a[10]=D*f+B*l+G*v+K*A;a[11]=D*g+B*m+G*x+K*b;D=c[12];B=c[13];G=c[14];K=c[15];a[12]=D*d+B*i+G*n+K*y;a[13]=D*e+B*k+G*u+K*C;a[14]=D*f+B*l+G*v+K*A;a[15]=D*g+B*m+G*x+K*b;return a}}; qi.Lm=qi.multiply; qi.translate=function(a,b,c){var d=c[0],e=c[1],c=c[2],f,g,i,k,l,m,n,u,v,x,y,C;if(b===a){a[12]=b[0]*d+b[4]*e+b[8]*c+b[12];a[13]=b[1]*d+b[5]*e+b[9]*c+b[13];a[14]=b[2]*d+b[6]*e+b[10]*c+b[14];a[15]=b[3]*d+b[7]*e+b[11]*c+b[15]}else{f=b[0];g=b[1];i=b[2];k=b[3];l=b[4];m=b[5];n=b[6];u=b[7];v=b[8];x=b[9];y=b[10];C=b[11];a[0]=f;a[1]=g;a[2]=i;a[3]=k;a[4]=l;a[5]=m;a[6]=n;a[7]=u;a[8]=v;a[9]=x;a[10]=y;a[11]=C;a[12]=f*d+l*e+v*c+b[12];a[13]=g*d+m*e+x*c+b[13];a[14]=i*d+n*e+y*c+b[14];a[15]=k*d+u*e+C*c+b[15]}return a}; qi.scale=function(a,b,c){var d=c[0],e=c[1],c=c[2];a[0]=b[0]*d;a[1]=b[1]*d;a[2]=b[2]*d;a[3]=b[3]*d;a[4]=b[4]*e;a[5]=b[5]*e;a[6]=b[6]*e;a[7]=b[7]*e;a[8]=b[8]*c;a[9]=b[9]*c;a[10]=b[10]*c;a[11]=b[11]*c;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a}; qi.rotate=function(a,b,c,d){var e=d[0],f=d[1],d=d[2],g=Math.sqrt(e*e+f*f+d*d),i,k,l,m,n,u,v,x,y,C,A,D,B,G,K,R,J,Z,ka,va;if(Math.abs(g)<Ei)return p;g=1/g;e=e*g;f=f*g;d=d*g;i=Math.sin(c);k=Math.cos(c);l=1-k;c=b[0];g=b[1];m=b[2];n=b[3];u=b[4];v=b[5];x=b[6];y=b[7];C=b[8];A=b[9];D=b[10];B=b[11];G=e*e*l+k;K=f*e*l+d*i;R=d*e*l-f*i;J=e*f*l-d*i;Z=f*f*l+k;ka=d*f*l+e*i;va=e*d*l+f*i;e=f*d*l-e*i;f=d*d*l+k;a[0]=c*G+u*K+C*R;a[1]=g*G+v*K+A*R;a[2]=m*G+x*K+D*R;a[3]=n*G+y*K+B*R;a[4]=c*J+u*Z+C*ka;a[5]=g*J+v*Z+A*ka;a[6]= m*J+x*Z+D*ka;a[7]=n*J+y*Z+B*ka;a[8]=c*va+u*e+C*f;a[9]=g*va+v*e+A*f;a[10]=m*va+x*e+D*f;a[11]=n*va+y*e+B*f;if(b!==a){a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15]}return a};qi.qN=function(a,b,c){var d=Math.sin(c),c=Math.cos(c),e=b[4],f=b[5],g=b[6],i=b[7],k=b[8],l=b[9],m=b[10],n=b[11];if(b!==a){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15]}a[4]=e*c+k*d;a[5]=f*c+l*d;a[6]=g*c+m*d;a[7]=i*c+n*d;a[8]=k*c-e*d;a[9]=l*c-f*d;a[10]=m*c-g*d;a[11]=n*c-i*d;return a}; qi.rN=function(a,b,c){var d=Math.sin(c),c=Math.cos(c),e=b[0],f=b[1],g=b[2],i=b[3],k=b[8],l=b[9],m=b[10],n=b[11];if(b!==a){a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15]}a[0]=e*c-k*d;a[1]=f*c-l*d;a[2]=g*c-m*d;a[3]=i*c-n*d;a[8]=e*d+k*c;a[9]=f*d+l*c;a[10]=g*d+m*c;a[11]=i*d+n*c;return a}; qi.sN=function(a,b,c){var d=Math.sin(c),c=Math.cos(c),e=b[0],f=b[1],g=b[2],i=b[3],k=b[4],l=b[5],m=b[6],n=b[7];if(b!==a){a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15]}a[0]=e*c+k*d;a[1]=f*c+l*d;a[2]=g*c+m*d;a[3]=i*c+n*d;a[4]=k*c-e*d;a[5]=l*c-f*d;a[6]=m*c-g*d;a[7]=n*c-i*d;return a}; qi.A1=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],i=d+d,k=e+e,l=f+f,b=d*i,m=d*k,d=d*l,n=e*k,e=e*l,f=f*l,i=g*i,k=g*k,g=g*l;a[0]=1-(n+f);a[1]=m+g;a[2]=d-k;a[3]=0;a[4]=m-g;a[5]=1-(b+f);a[6]=e+i;a[7]=0;a[8]=d+k;a[9]=e-i;a[10]=1-(b+n);a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a}; qi.pW=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,i=d+d,k=e+e,c=c*g,l=d*g,d=d*i,m=e*g,n=e*i,e=e*k,g=f*g,i=f*i,f=f*k;a[0]=1-d-e;a[1]=l+f;a[2]=m-i;a[3]=0;a[4]=l-f;a[5]=1-c-e;a[6]=n+g;a[7]=0;a[8]=m+i;a[9]=n-g;a[10]=1-c-d;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};qi.C1=function(a,b,c,d,e,f,g){var i=1/(c-b),k=1/(e-d),l=1/(f-g);a[0]=f*2*i;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=f*2*k;a[6]=0;a[7]=0;a[8]=(c+b)*i;a[9]=(e+d)*k;a[10]=(g+f)*l;a[11]=-1;a[12]=0;a[13]=0;a[14]=g*f*2*l;a[15]=0;return a}; qi.NY=function(a,b,c){var b=1/Math.tan(b/2),d=1/-999.99;a[0]=b/c;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1000.01*d;a[11]=-1;a[12]=0;a[13]=0;a[14]=20*d;a[15]=0};qi.Y2=function(a,b,c,d,e,f,g){var i=1/(b-c),k=1/(d-e),l=1/(f-g);a[0]=-2*i;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*k;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*l;a[11]=0;a[12]=(b+c)*i;a[13]=(e+d)*k;a[14]=(g+f)*l;a[15]=1;return a}; qi.J2=function(a,b,c,d){var e,f,g,i,k,l,m,n,u=b[0],v=b[1],b=b[2];g=d[0];i=d[1];f=d[2];m=c[0];d=c[1];e=c[2];if(Math.abs(u-m)<Ei&&Math.abs(v-d)<Ei&&Math.abs(b-e)<Ei)return qi.zm(a);c=u-m;d=v-d;m=b-e;n=1/Math.sqrt(c*c+d*d+m*m);c=c*n;d=d*n;m=m*n;e=i*m-f*d;f=f*c-g*m;g=g*d-i*c;if(n=Math.sqrt(e*e+f*f+g*g)){n=1/n;e=e*n;f=f*n;g=g*n}else g=f=e=0;i=d*g-m*f;k=m*e-c*g;l=c*f-d*e;if(n=Math.sqrt(i*i+k*k+l*l)){n=1/n;i=i*n;k=k*n;l=l*n}else l=k=i=0;a[0]=e;a[1]=i;a[2]=c;a[3]=0;a[4]=f;a[5]=k;a[6]=d;a[7]=0;a[8]=g;a[9]= l;a[10]=m;a[11]=0;a[12]=-(e*u+f*v+g*b);a[13]=-(i*u+k*v+l*b);a[14]=-(c*u+d*v+m*b);a[15]=1;return a};qi.an=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"}; qi.gD=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};"undefined"!==typeof exports&&(exports.O2=qi);var Qi={create:function(){var a=new Fi(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a}}; Qi.r3=function(){var a=Mi.create(),b=Mi.rg(1,0,0),c=Mi.rg(0,1,0);return function(d,e,f){var g=Mi.os(e,f);if(g<-0.999999){Mi.zw(a,b,e);Mi.length(a)<1.0E-6&&Mi.zw(a,c,e);Mi.normalize(a,a);Qi.qZ(d,a);return d}if(g>0.999999){d[0]=0;d[1]=0;d[2]=0;d[3]=1;return d}Mi.zw(a,e,f);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=1+g;return Qi.normalize(d,d)}}(); Qi.u3=function(){var a=Pi.create();return function(b,c,d,e){a[0]=d[0];a[3]=d[1];a[6]=d[2];a[1]=e[0];a[4]=e[1];a[7]=e[2];a[2]=-c[0];a[5]=-c[1];a[8]=-c[2];return Qi.normalize(b,Qi.oW(b,a))}}();Qi.bi=Y.bi;Qi.rg=Y.rg;Qi.copy=Y.copy;Qi.set=Y.set;Qi.zm=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};Qi.qZ=function(a,b){var c=Math.PI,c=c*0.5,d=Math.sin(c);a[0]=d*b[0];a[1]=d*b[1];a[2]=d*b[2];a[3]=Math.cos(c)};Qi.add=Y.add; Qi.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],b=b[3],g=c[0],i=c[1],k=c[2],c=c[3];a[0]=d*c+b*g+e*k-f*i;a[1]=e*c+b*i+f*g-d*k;a[2]=f*c+b*k+d*i-e*g;a[3]=b*c-d*g-e*i-f*k;return a};Qi.Lm=Qi.multiply;Qi.scale=Y.scale;Qi.qN=function(a,b,c){var c=c*0.5,d=b[0],e=b[1],f=b[2],b=b[3],g=Math.sin(c),c=Math.cos(c);a[0]=d*c+b*g;a[1]=e*c+f*g;a[2]=f*c-e*g;a[3]=b*c-d*g;return a}; Qi.rN=function(a,b,c){var c=c*0.5,d=b[0],e=b[1],f=b[2],b=b[3],g=Math.sin(c),c=Math.cos(c);a[0]=d*c-f*g;a[1]=e*c+b*g;a[2]=f*c+d*g;a[3]=b*c-e*g;return a};Qi.sN=function(a,b,c){var c=c*0.5,d=b[0],e=b[1],f=b[2],b=b[3],g=Math.sin(c),c=Math.cos(c);a[0]=d*c+e*g;a[1]=e*c-d*g;a[2]=f*c+b*g;a[3]=b*c-f*g;return a};Qi.W0=function(a,b){var c=b[0],d=b[1],e=b[2];a[0]=c;a[1]=d;a[2]=e;a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e));return a};Qi.os=Y.os;Qi.Cx=Y.Cx; Qi.D3=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],b=b[3],i=c[0],k=c[1],l=c[2],c=c[3],m,n,u;n=e*i+f*k+g*l+b*c;if(n<0){n=-n;i=-i;k=-k;l=-l;c=-c}if(1-n>1.0E-6){m=Math.acos(n);u=Math.sin(m);n=Math.sin((1-d)*m)/u;d=Math.sin(d*m)/u}else n=1-d;a[0]=n*e+d*i;a[1]=n*f+d*k;a[2]=n*g+d*l;a[3]=n*b+d*c;return a};Qi.ep=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f,g=g?1/g:0;a[0]=-c*g;a[1]=-d*g;a[2]=-e*g;a[3]=f*g;return a};Qi.b1=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=b[3];return a}; Qi.length=Y.length;Qi.mE=Qi.length;Qi.Lk=Y.Lk;Qi.pF=Qi.Lk;Qi.normalize=Y.normalize;Qi.oW=function(a,b){var c=b[0]+b[4]+b[8];if(c>0){c=Math.sqrt(c+1);a[3]=0.5*c;c=0.5/c;a[0]=(b[7]-b[5])*c;a[1]=(b[2]-b[6])*c;a[2]=(b[3]-b[1])*c}else{var d=0;b[4]>b[0]&&(d=1);b[8]>b[d*3+d]&&(d=2);var e=(d+1)%3,f=(d+2)%3,c=Math.sqrt(b[d*3+d]-b[e*3+e]-b[f*3+f]+1);a[d]=0.5*c;c=0.5/c;a[3]=(b[f*3+e]-b[e*3+f])*c;a[e]=(b[e*3+d]+b[d*3+e])*c;a[f]=(b[f*3+d]+b[d*3+f])*c}return a}; Qi.an=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};"undefined"!==typeof exports&&(exports.k3=Qi);function Ri(a,b){this.Gf=a;this.mq=b||2;this.nA=a-this.mq;this.tc=[];this.Hg=[];this.XD()}w.extend(Ri.prototype,{XD:function(){var a,b;this.tc.push(0,-20,0);for(S=0;360>S;S+=6)a=Math.cos(Lb(S))*this.Gf,b=Math.sin(Lb(S))*this.Gf,this.tc.push(a,-20,b)},WD:function(){for(var a=(this.tc.length-3)/3,b=1;b<a;b++)this.Hg.push(0,b,b+1);this.Hg.push(0,b,1)},uD:function(){0==this.Hg.length&&this.WD();return this.Hg}});function Si(a,b){this.Gf=a;this.mq=b||2;this.nA=a-this.mq;this.tc=[];this.Hg=[];this.XD()} w.extend(Si.prototype,{XD:function(){for(var a,b,c=0;360>c;c+=6)a=Math.cos(Lb(c))*this.nA,b=Math.sin(Lb(c))*this.nA,this.tc.push(a,-20,b);for(c=0;360>c;c+=6)a=Math.cos(Lb(c))*this.Gf,b=Math.sin(Lb(c))*this.Gf,this.tc.push(a,-20,b)},WD:function(){var a=this.tc.length/3/2;for(S=0;S<a-1;S++)this.Hg.push(S,S+a+1,S+a),this.Hg.push(S,S+1,S+a+1);this.Hg.push(S,a,S+a);this.Hg.push(S,0,a)},uD:function(){0==this.Hg.length&&this.WD();return this.Hg}});function Ti(a){this.Gf=a;this.Od=Math.pow(2,4);this.wr=this.Od/2;this.tc=[];this.Lz=[];a=360/this.Od;this.hJ=Math.cos(Lb(3*a))*this.Gf;this.iJ=Math.cos(Lb(2*a))*this.Gf;this.jJ=Math.cos(Lb(1*a))*this.Gf;this.PX()} w.extend(Ti.prototype,{PX:function(){if(!(0<this.tc.length))for(var a=this.Gf,b=[],c=64/this.Od,d=64/c,e=[],f=0,g=0,i,k=0;33>k;k++)for(var l=Math.cos(Lb(5.625*k-90))*a,l=Math.round(100*l)/100,m=Math.sin(Lb(5.625*k-90))*a,m=Math.round(100*m)/100,f=Math.floor(k/c),n=0;64>n;n++){var u=Math.cos(Lb(5.625*n))*l,v=Math.sin(Lb(5.625*n))*l,u=Math.round(100*u)/100,v=Math.round(100*v)/100;b.push(u,m,v);g=Math.floor(n/c);i=g+f*d;f<this.wr&&(this.tc[i]||(this.tc[i]=[]),this.tc[i].push(u,m,v));if(0<f&&0==k%c){var x= g+(f-1)*d;this.tc[x].push(u,m,v);0<n&&0==n%c&&this.tc[x-1]&&this.tc[x-1].push(u,m,v);63==n&&this.tc[x].push(e[0],e[1],e[2])}0==g&&0==n&&(e=[u,m,v]);0<n&&0==n%c&&this.tc[i-1]&&this.tc[i-1].push(u,m,v);f<this.wr&&63==n&&this.tc[i].push(e[0],e[1],e[2])}},OX:function(){for(var a=64/this.Od,b=a+1,c=0;c<a;c++)for(var d=0;d<a;d++){var e=c*b,f=e+d+1;this.Lz.push(e+d,f,e+d+1+b);f=e+d+1+b;this.Lz.push(e+d,f,e+b+d)}return this.Lz},tW:function(a,b,c){var d=this.tc[Math.round(this.tc.length/2)];if(d){for(var e= [],f=Math.pow(2,5-a),b=b%f,c=c%f,g=64/this.Od,i=1/g,k=1/(32/this.wr),l=0;l<d.length/3;l++){var m=l%(g+1)*i,n=Math.floor(l/(g+1))*k,m=m/f+1*b/f,n=n/f+1*c/f;1===a&&(n*=2);e.push(m,n)}return e}},GW:function(a){var b=0,c=0,c=a[0],b=a[1],d=a[2],a=Math.round(180*Math.atan(Math.abs(d)/Math.abs(c))/Math.PI);0<c?0>d&&(a=360-a):a=0<d?180-a:180+a;c=b>this.jJ?7:b>this.iJ?6:b>this.hJ?5:0<b?4:b>-this.hJ?3:b>-this.iJ?2:b>-this.jJ?1:0;b=Math.floor(a/22.5);return[b,c,b+c*(64/(64/this.Od))]}});function ji(a){this.M=a;this.ge=this.eb=this.Va=this.Wi=p;var b=this;this.Jr=new ri(6,{yo:function(a){for(var d=0;d<a.length;d++)if(a[d])for(var e=0;e<a[d].length;e++)a[d][e]&&(b.eb.deleteTexture(a[d][e].zy),a[d][e].ns=q)}});this.YI=new ri(32,{yo:function(a){a&&(a.Mz=o,a.src="")}});this.eA=new si;this.Od=16;this.wr=8;this.Gf=500;this.Oj=this.Xi=0;this.Ef=[qi.create(),qi.create()];this.Qh=qi.create();this.HA=[qi.create(),qi.create()];this.hr=qi.create();this.FA=[];this.Kl=this.jo=this.Kv=p;this.Er= {};this.mR();this.sB=0;this.Qu=[p,p];this.fA=[p,p];this.kg=[];this.jg=F()?2:1;this.Mi()} w.extend(ji.prototype,{mR:function(){this.gl=[];for(var a=2;5>=a;a++)this.gl[a]={cols:Math.pow(2,a-1),rows:Math.pow(2,a-1)/2};this.gl[1]={cols:1,rows:1}},Mi:function(){this.xz();this.eb=this.Va.getContext("webgl",{alpha:q});this.Sv=Ci.get(this.eb,this.M.aa);this.kA();this.QT();this.Pz();this.Qz();this.hT();this.Sv.VD()},xz:function(){var a=this.Va=L("canvas"),b=this.Va.style,c=this.M.z,d=c.clientWidth,c=c.clientHeight;b.width=d+"px";b.height=c+"px";this.Xi=a.width=d*this.jg;this.Oj=a.height=c*this.jg; this.M.Vh.appendChild(this.Va)},QT:function(){var a=this.eb,b=this.Va;a.clearColor(0,0,0,1);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);a.disable(a.DEPTH_TEST);a.enable(a.BLEND);a.depthMask(o);a.viewport(0,0,b.width,b.height)},Dk:function(){var a=this.M.z,b=a.clientWidth,a=a.clientHeight;this.Va.style.width=b+"px";this.Va.style.height=a+"px";this.Xi=this.Va.width=b*this.jg;this.Oj=this.Va.height=a*this.jg;this.Hq=p;b=this.Va;this.eb.viewport(0,0,b.width,b.height)},kA:function(){var a=this.eb,b= this.ge=a.createProgram(),c=this.ml("attribute vec3 aVertexPosition;\\nattribute vec2 aVertexTextureCoordBack;\\nattribute vec2 aVertexTextureCoord;\\nvarying mediump vec2 vTextureCoordBack;\\nvarying mediump vec2 vTextureCoord;\\nuniform mat4 uMVMatrix;\\nuniform mat4 uPMatrix;\\nvoid main(void) {\\n    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\\n    vTextureCoordBack = aVertexTextureCoordBack;\\n    vTextureCoord = aVertexTextureCoord;\\n}",a.VERTEX_SHADER),d=this.ml("precision mediump float;\\nvarying vec2 vTextureCoordBack;\\nvarying vec2 vTextureCoord;\\nuniform sampler2D uSamplerBack;\\nuniform sampler2D uSampler;\\nuniform bool uDrawThumb;\\nuniform bool uDrawBack;\\nuniform float uAlpha;\\nvoid main(void) {\\n    if (uDrawThumb) {\\n        gl_FragColor = texture2D(uSamplerBack, vTextureCoordBack);\\n        return;\\n    }\\n    if (uAlpha == 1.0) {\\n        gl_FragColor = texture2D(uSampler, vTextureCoord);\\n        return;\\n    }\\n    if (uDrawBack) {\\n        gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha + texture2D(uSamplerBack, vTextureCoordBack) * (1.0 - uAlpha);\\n    } else {\\n        vec4 textureColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\\n        gl_FragColor =  vec4(textureColor.rgb, textureColor.a * uAlpha);\\n    }\\n}", a.FRAGMENT_SHADER);a.attachShader(b,c);a.attachShader(b,d);a.bindAttribLocation(b,0,"aVertexPosition");a.linkProgram(b)},ml:function(a,b){var c=this.eb,d=c.createShader(b);c.shaderSource(d,a);c.compileShader(d);return d},hT:function(){var a=new Ti(this.Gf),b=a.OX();this.Er={NN:a,jW:b,iW:a.tc}},setData:function(a){a!==p&&(this.xl=this.da?this.da.id:p,this.SA=this.da||p);(this.da=a)&&this.Jr.setData(a.id,[])},ta:function(a,b){if(this.da){this.Ba=a;this.Ze=b;var c=this.Va;this.Wi||(this.Wi=this.M.ea()); this.Hq||(this.Hq=180/Math.pow(2,this.Wi),this.oU=c.width/c.height,qi.NY(this.Qh,Lb(this.Hq),this.oU),qi.ep(this.hr,this.Qh));this.jz(0);c=this.Rz(0);this.Qu[0]=c[0];this.fA[0]=c[1];this.AS();this.Fr()}},jz:function(a){qi.zm(this.Ef[a]);qi.rotate(this.Ef[a],this.Ef[a],Lb(this.Ba.pitch),[-1,0,0]);var b=this.da.tiles.dirNorth;1==a&&this.SA&&(b=this.SA.tiles.dirNorth);qi.rotate(this.Ef[a],this.Ef[a],Lb(b+this.Ba.heading+90),[0,1,0]);qi.ep(this.HA[a],this.Ef[a])},Nj:function(a,b,c){var d=this.Xi,e=this.Oj, f=Y.create(),g=this.hr,c=this.HA[c],a=Y.rg(2*a/d-1,1-2*b/e,-1,1);qi.multiply(f,g,a);qi.multiply(f,c,f);b=this.Gf;g=200*f[0];a=200*f[1];f=200*f[2];b=Math.sqrt(-(-b*b)/(g*g+a*a+f*f));return this.Er.NN.GW([g*b,a*b,f*b])},DH:function(a,b,c,d){var e=this.Oj,b=Y.rg(a,b,c,1),a=Y.create();qi.multiply(a,this.Ef[d],b);b=Y.rg(a[0],a[1],a[2],a[3]);qi.multiply(a,this.Qh,b);if(0!==a[3])return d=(1-Mi.rg(a[0]/a[3],a[1]/a[3],a[2]/a[3])[1])*e/2,0<a[3]&&0<d&&d<e?o:q},Lc:function(a,b,c){var c=c||{},d=c.mp||q,e=c.XY|| p;this.$n=this.Ze;this.Ze=b;this.Hq=p;var f=this,g=this.Wi,i=a-g;f.Sq&&(f.Sq.stop(),f.Sq=p);d?(f.Wi=a,f.qU=q,f.ta(f.Ba,b)):f.Sq=new pb({duration:600,Fc:60,gc:qb.wK,ta:function(a){if(a!=0){f.Hq=p;f.Wi=g+i*a;a<0.5?f.ta(f.Ba,f.$n):f.ta(f.Ba,b);e&&e(f.Wi)}},finish:function(){f.Sq=p;f.Wi=a;f.qU=q;f.M.dispatchEvent(new N("onzoom_changed"))},lt:function(){f.M.dispatchEvent(new N("onzoom_changed"));f.Sq=p}})},AS:function(){var a=this;this.pI(0,0,1,function(){a.Og||a.RH()})},RH:function(){for(var a=this.fA[0], b=a[0],c=a[1],d=a[3],a=a[2];a<=d;a++){var e=b,f=c;"number"===typeof this.gA&&(a>=this.gA&&a<=this.EH)&&(e=0,f=this.gl[this.Ze].cols-1);for(;e<=f;e++)this.pI(e,a)}},pI:function(a,b,c,d){var c=c||this.Ze,e=this.gl[c].cols,f=this.gl[c].rows,g=this,a=g.VA(a,c);0>b&&(a=g.VA(e-1-a,c),b=0);b>f-1&&(a=g.VA(e-1-a,c),b=f-1);var i=a+b*e,k=g.Jr.getData(g.da.id);k[c]||(k[c]=[]);k[c][i]||(k[c][i]={});var l=k[c][i];l.loaded?(g.MI(c)&&g.TI(),d&&d()):(l.index=i,l.loaded=q,l.GY=g.da.id,g.zS(a,b,c,function(a){if(l.GY== g.da.id){l.loaded=o;var b=k[c][i];if(!b.ns){g.PT(b,a,c);if(c>1)b.Pl={duration:300,startTime:Date.now(),iC:0,Co:1};b.ns=o}g.MI(c)&&g.TI();d&&d();g.Fr()}}))},MI:function(a){return 1===a&&this.xl&&this.M.cJ?o:q},DN:ba("KS"),VA:function(a,b){for(var c=a,d=this.gl[b||this.Ze].cols;0>c;)c+=d;return c%d},vf:function(){this.sB--;0===this.sB&&this.M.dispatchEvent(new N("ontilesloaded"))},Fr:function(){this.Eu&&(clearTimeout(this.Eu),this.Eu=p);var a=this;this.Eu=setTimeout(function(){cancelAnimationFrame(a.sv); a.sv=p;a.Eu=p},300);this.sv||this.rv()},rv:function(){var a=this;a.sv=requestAnimationFrame(function(){a.rv()});var b=this.ge;this.eb.useProgram(b);var c=this.Sv;c.Go(b.kn);c.Go(b.zO);c.Go(b.gu);c.zC();b=q;this.Og?this.mT():b=this.$A(0);if(b&&!this.Og)for(b=0;b<this.kg.length;b++)this.kg[b].rv(this.Qh,this.Ef[0],this.hr,this.HA[0])},$A:function(a,b){if(!this.da)return q;var c=this.Qu[a];if(!c)return q;var d=0==a?this.da.id:this.xl;if(!d)return q;b&&qi.translate(this.Ef[a],this.FA[a],b);var e=c[0], f=c[1],g=c[2],c=c[3];this.Og&&0==a&&(e-=2,f+=2,g-=2,c+=2,g=0>g?0:g);d=this.Jr.getData(d);if(!d)return q;for(;g<=c;g++){var i=e,k=f;"number"===typeof this.fk&&(g>=this.fk&&g<=this.Ll)&&(i=0,k=this.Od-1);for(;i<=k;i++){for(var l=i;0>l;)l+=this.Od;var l=l%this.Od,m=this.dl(l,g)[2],n=this.dl(l,g,this.$n)[2],u=this.dl(l,g,1)[2],v=p,x=p,y=1;d[this.Ze]&&(d[this.Ze][m]&&d[this.Ze][m].ns)&&(v=m);d[this.$n]&&d[this.$n][n]&&d[this.$n][n].ns?(x=n,y=this.$n):d[1][u]&&d[1][u].ns&&(x=u);if(v===p&&x===p)return q; m=this.eb;n=this.ge;u=this.Ze;this.Og&&1==a?(m.uniform1i(n.sK,q),v===p&&(v=x,u=1),x=p):m.uniform1i(n.sK,o);this.sS(v,u,x,y,a);this.OT(l,g,u,y);this.fB(a);this.XQ()}}return o},dl:function(a,b,c){var c=c||this.Ze,d=Math.pow(2,5-c),a=Math.floor(a/d),b=Math.floor(b/d),b=this.gl[c].rows-b-1;return[a,b,a+b*this.Od/d]},PT:function(a,b,c){if(a){var d=this.eb;1===c?d.activeTexture(d.TEXTURE0):d.activeTexture(d.TEXTURE1);a.zy=d.createTexture();d.bindTexture(d.TEXTURE_2D,a.zy);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL, o);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,b);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR)}},sS:function(a,b,c,d,e){var f=0==e?this.da.id:this.xl;if(f){var g=this.Jr.getData(f),f=this.eb,i=this.ge;a===p?f.uniform1i(i.tK,o):f.uniform1i(i.tK,q);var k=p;g[d]&&g[d][c]&&(f.activeTexture(f.TEXTURE0), k=g[d][c].zy,f.bindTexture(f.TEXTURE_2D,k),f.uniform1i(i.fZ,0));if("number"===typeof a){f.activeTexture(f.TEXTURE1);f.bindTexture(f.TEXTURE_2D,g[b][a].zy);f.uniform1i(i.gZ,1);a=g[b][a];"number"!=typeof a.Co&&(a.Co=1);if(1==e&&(!a.Pl||0!=a.Pl.Co))a.Pl={duration:400,startTime:this.Dv,iC:1,Co:0},a.Co=0;a.Pl?(e=a.Pl,b=(Date.now()-e.startTime)/e.duration,0==e.iC?(e=b,1<e&&(e=1,a.Pl=p)):(e=e.iC*(1-b),0>e&&(e=0,a.Pl=p)),f.uniform1f(i.alpha,e)):f.uniform1f(i.alpha,a.Co)}}},OT:function(a,b,c,d){var e=this.bS(a, b),f=this.Er.jW,c=this.wH(a,b,c),a=this.wH(a,b,d),b=this.eb;this.Kv||(this.Kv=b.createBuffer());b.bindBuffer(b.ARRAY_BUFFER,this.Kv);b.bufferData(b.ARRAY_BUFFER,new Float32Array(e),b.STATIC_DRAW);this.jo||(this.jo=b.createBuffer(),this.jo.DF=f.length,b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.jo),b.bufferData(b.ELEMENT_ARRAY_BUFFER,new Uint16Array(f),b.STATIC_DRAW));this.wB||(this.wB=b.createBuffer());b.bindBuffer(b.ARRAY_BUFFER,this.wB);b.bufferData(b.ARRAY_BUFFER,new Float32Array(a),b.STATIC_DRAW); c&&(this.Kl||(this.Kl=b.createBuffer()),b.bindBuffer(b.ARRAY_BUFFER,this.Kl),b.bufferData(b.ARRAY_BUFFER,new Float32Array(c),b.STATIC_DRAW))},XQ:function(){var a=this.eb,b=this.ge;a.bindBuffer(a.ARRAY_BUFFER,this.Kv);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.jo);a.vertexAttribPointer(b.kn,3,a.FLOAT,q,0,0);a.bindBuffer(a.ARRAY_BUFFER,this.wB);a.vertexAttribPointer(b.zO,2,a.FLOAT,q,0,0);a.bindBuffer(a.ARRAY_BUFFER,this.Kl);a.vertexAttribPointer(b.gu,2,a.FLOAT,q,0,0);a.drawElements(a.TRIANGLES,this.jo.DF, a.UNSIGNED_SHORT,0)},bS:function(a,b){return this.Er.iW[a+b*(64/(64/this.Od))]},wH:function(a,b,c){return this.Er.NN.tW(c||this.Ze,a,b)},Pz:function(){var a=this.ge,b=this.eb;a.mt=b.getUniformLocation(a,"uPMatrix");a.jt=b.getUniformLocation(a,"uMVMatrix");a.tK=b.getUniformLocation(a,"uDrawThumb");a.sK=b.getUniformLocation(a,"uDrawBack");a.alpha=b.getUniformLocation(a,"uAlpha");a.fZ=b.getUniformLocation(a,"uSamplerBack");a.gZ=b.getUniformLocation(a,"uSampler")},Qz:function(){var a=this.ge,b=this.eb; a.kn=b.getAttribLocation(a,"aVertexPosition");a.zO=b.getAttribLocation(a,"aVertexTextureCoordBack");a.gu=b.getAttribLocation(a,"aVertexTextureCoord")},fB:function(a){var b=this.ge,c=this.eb;c.uniformMatrix4fv(b.mt,q,this.Qh);c.uniformMatrix4fv(b.jt,q,this.Ef[a])},qq:function(a,b,c,d){return a+"_"+b+"_"+c+"_"+d},zS:function(a,b,c,d){var e=this.qq(this.da.id,a,b,c),f=this.YI.getData(e);this.sB++;if(f)f.br&&(d(f),this.vf());else{f=this.eA.Ww();f.crossOrigin="anonymous";f.br=q;var g=this;f.onload=function(){-1!= this.src.indexOf("pos=0_0&z=1")&&g.M.dispatchEvent(new N("onthumbnail_complete"));d(this);g.vf();this.br=o};f.src=this.da.tiles.getTilesUrl(this.da.id,new P(a,b),c);this.YI.setData(e,f)}},Rz:function(a){var b=this.Xi,c=this.Oj,d,e,f,g,i,k=this.Nj(0,0,a);d=k[0];g=k[1];k=this.Nj(b/2,0,a);k[1]>g&&(g=k[1]);k=this.Nj(b,0,a);e=k[0];e<d&&(e+=this.Od);i=k[1];k=this.Nj(0,c/2,a);k[0]>e&&(k[0]-=this.Od);k[0]<d&&(d=k[0]);k=this.Nj(b,c/2,a);k[0]<d&&(k[0]+=this.Od);k[0]>e&&(e=k[0]);k=this.Nj(0,c,a);k[0]>e&&(k[0]-= this.Od);k[0]<d&&(d=k[0]);f=k[1];k=this.Nj(b/2,c,a);k[1]<f&&(f=k[1]);k=this.Nj(b,c,a);k[0]<d&&(k[0]+=this.Od);k[0]>e&&(e=k[0]);b=k[1];this.DH(0,100,0,a)?(this.Ll=this.wr-1,this.fk=i):this.DH(0,-100,0,a)?(this.fk=0,this.Ll=b):this.EH=this.gA=this.Ll=this.fk=p;this.Ll!=p&&g<this.Ll&&(g=this.Ll);this.fk!=p&&f>this.fk&&(f=this.fk);b=this.dl(d,g);c=this.dl(e,f);a=b[0];i=c[0];b=b[1];c=c[1];this.gA=this.dl(0,this.fk)[1];this.EH=this.dl(0,this.Ll)[1];return[[d,e,f,g],[a,i,b,c]]},uU:function(a){this.kg.push(a)}, TI:function(){if(!this.Og&&(this.jz(1),this.FA[0]=qi.bi(this.Ef[0]),this.FA[1]=qi.bi(this.Ef[1]),this.Qu[1]=this.Rz(1)[0],this.Og=o,this.Ez=160,this.Fz=120,"number"==typeof this.M.RG)){var a=Math.pow(this.M.RG,0.25);this.Ez*=a;this.Fz*=a}},iI:function(){this.Og=q;this.Dv=this.xl=p;this.jz(0);var a=this.Rz(0);this.Qu[0]=a[0];this.fA[0]=a[1];this.RH();this.Fr()},mT:function(){this.Dv||(this.Dv=Date.now());this.Fr();this.DQ=Date.now();var a=this.DQ-this.Dv;if(400<a)this.iI();else{var a=a/400,a=-a*(a- 2),b=this.SA.links[this.KS];if(b){var c=b.dir+this.da.tiles.dirNorth;360<c&&(c%=360);var d=this.Ez*(1-a),e=Math.cos(Lb(c))*d,c=Math.sin(Lb(c))*d;try{this.$A(0,[e,0,c])}catch(f){}d=this.Fz*a;e=Math.cos(Lb(b.wh))*d;c=Math.sin(Lb(b.wh))*d;try{this.$A(1,[-e,0,-c])}catch(g){}}else this.iI()}},rC:function(){cancelAnimationFrame(this.sv);this.Jr.clear()}});function ki(a,b){this.M=a;this.Va=b;this.Xi=b.width;this.Oj=b.height;this.eb=b.getContext("webgl",{alpha:q});this.Sv=Ci.get(this.eb,this.M.aa);this.da=this.ge=p;this.Oa=q;this.Mi();this.Mn=this.Qj=o;this.Fn=[0,-20,0];this.jg=F()?2:1;this.An=this.Bn=this.zn=p;this.Nd={};a.xA=this;this.fo=a.kg.vd;this.Qd=new Q}var Ui=[10,-20,30,10,-20,10,-10,-20,10,-10,-20,30],Vi=[0,0,0,1,1,1,1,0],Wi=[2.2,-20,22.3,2.2,-20,13.7,-2.2,-20,13.7,-2.2,-20,22.3],Xi=[0,0,0,0.5,0.25,0.5,0.25,0]; w.extend(ki.prototype,{Mi:function(){this.GG=new Ri(8.5);this.zI=new Si(10,1.5);this.BS();this.kA();this.nS();this.ba();this.Pz();this.Qz()},BS:function(){var a=new Image,b=this;a.crossOrigin="anonymous";a.onload=function(){this.br=o;b.zn=b.eb.createTexture();b.lA(b.zn,this)};a.src="http://map.baidu.com/res_mobile2/images/link-arrow-shadow.png";a=new Image;a.crossOrigin="anonymous";a.onload=function(){this.br=o;b.Bn=b.eb.createTexture();b.lA(b.Bn,this)};a.src="http://map.baidu.com/res_mobile2/images/link-arrow.png"; a=new Image;a.crossOrigin="anonymous";a.onload=function(){this.br=o;b.An=b.eb.createTexture();b.lA(b.An,this)};a.src="http://map.baidu.com/res_mobile2/images/dir-texture.png"},kA:function(){var a=this.eb,b=this.ge=a.createProgram(),c=this.ml("attribute vec3 aVertexPosition;\\nuniform mat4 uMVMatrix;\\nuniform mat4 uPMatrix;\\nvoid main(void) {\\n    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\\n}",a.VERTEX_SHADER),d=this.ml("precision mediump float;\\nuniform float uColor;\\nuniform float uAlpha;\\nvoid main(void) {\\n    gl_FragColor = vec4(uColor, uColor, uColor, 1.0) * uAlpha;\\n}", a.FRAGMENT_SHADER);a.attachShader(b,c);a.attachShader(b,d);a.linkProgram(b);a.useProgram(b)},nS:function(){var a=this.eb,b=this.Wu=a.createProgram(),c=this.ml("attribute vec3 aVertexPosition;\\nattribute vec2 aVertexTextureCoord;\\nvarying highp vec2 vTextureCoord;\\nuniform mat4 uMVMatrix;\\nuniform mat4 uPMatrix;\\nvoid main(void) {\\n    gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\\n    vTextureCoord = aVertexTextureCoord;\\n}",a.VERTEX_SHADER),d=this.ml("precision mediump float;\\nuniform sampler2D uSampler;\\nvarying highp vec2 vTextureCoord;\\nvoid main(void) {\\n    gl_FragColor = texture2D(uSampler, vTextureCoord);\\n}", a.FRAGMENT_SHADER);a.attachShader(b,c);a.attachShader(b,d);a.linkProgram(b);a.useProgram(b)},ml:function(a,b){var c=this.eb,d=c.createShader(b);c.shaderSource(d,a);c.compileShader(d);return d},lA:function(a,b){var c=this.eb;c.activeTexture(c.TEXTURE2);c.bindTexture(c.TEXTURE_2D,a);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,q);c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,b);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D, c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR);c.bindTexture(c.TEXTURE_2D,p)},ba:function(){var a=this;w.K(this.Va,"touchstart",function(b){if(!a.fo.Og){a.$H=[a.M.Ca().heading,a.M.Ca().pitch];var c=b.changedTouches[0].pageX*a.jg,d=b.changedTouches[0].pageY*a.jg,e=p;a.Qj&&(e=a.mH(c,d));a.H0=[c,d];a.AH=e;e!==p&&(a.M.dispatchEvent(new N("onlinktouchstart")),a.UT=setTimeout(function(){for(var d= a.da.links,g=0;g<d.length;g++)if(d[g].id===e){a.EQ=d[g].dir;a.ib=g;break}a.zH=o;a.Fl=o;a.M.Fl=o;d=[c,(b.changedTouches[0].pageY-60)*a.jg];a.Fn=a.Mq(d);a.MG=a.iz(d);a.M.dispatchEvent(new N("onrefresh"));a.M.dispatchEvent(new N("onlongjumpstart"))},300))}});w.K(this.Va,"touchend",function(){clearTimeout(a.UT);if(!a.fo.Og)if(a.fo.DN(a.ib),a.Fl){a.Fl=q;a.M.Fl=q;a.zH=q;var b=a.EQ,c=a.iz();if(5>c)a.M.dispatchEvent(new N("onrefresh")),a.M.dispatchEvent(new N("onlongjumpcancel"));else{var d=a.da.th+Math.sin(Lb(b))* c,b=a.da.uh+Math.cos(Lb(b))*c;a.M.dispatchEvent(new N("onrefresh"));a.M.dispatchEvent(new N("onlongjumpend"));d=new H(d,b);a.M.ra(a.Qd.oh(d),{Sl:o})}}else d=a.M.Ca(),a.lU=1<Math.abs(Math.round(a.$H[0])-Math.round(d.heading))||1<Math.abs(Math.round(a.$H[1])-Math.round(d.pitch))?q:o,a.lU&&a.da&&a.AH&&(a.M.dispatchEvent(new N("onlinkclick")),a.M.pc(a.AH,{Sl:o}),a.M.dispatchEvent(new N("onlinktouchend")))});w.K(this.Va,"touchmove",function(b){!a.fo.Og&&a.Fl&&(a.MG=a.iz([b.changedTouches[0].pageX*a.jg, (b.changedTouches[0].pageY-60)*a.jg]),a.M.dispatchEvent(new N("onrefresh")))})},gS:function(a,b){var c=a[2],d=[(b[0]+b[3]+b[6]+b[9])/4,(b[2]+b[5]+b[8]+b[11])/4];return 12>Math.abs(a[0]-d[0])&&12>Math.abs(c-d[1])?o:q},mH:function(a,b){if(!this.Qj)return p;var c=this.wS[1],d=this.Mq([a,b],c[1]);if(!d)return p;for(var e=0,f=this.da.links.length;e<f;e++){var g=c.slice(12*e,12*e+12);if(this.gS(d,g)){this.ib=e;break}}return this.da.links[e]?this.da.links[e].id:p},qL:function(a,b){if(0===this.da.links.length|| this.Mn===q)return 0;var c=this.Mq([a,b]),d=q;if(!c){d=this.M.ea();c=this.Mq([a,b+50*Math.pow(2,d-2)]);if(!c)return 0;d=o}for(var e=this.M.Ca().heading;0>e;)e+=360;var e=this.hR(e%360),f=this.da.links[e].wh,g=Math.sin(Lb(f)),f=Math.cos(Lb(f)),i=-g*c[0]+f*c[2];if(100<i||-100>i)return 0;c=(f*c[0]+g*c[2])/9;if(3.6>c)return 0;g=this.da.links[e];f=this.XP([this.da.th,0,this.da.uh],[g.x,0,g.y]);this.fo.DN(e);if(c<f)return this.M.pc(g.id,{Sl:o}),this.M.dispatchEvent(new N("onclickonroad")),c;300<c&&(c=300); d&&(c=300);e=this.da.links[e].dir;d=this.da.th+Math.sin(Lb(e))*c;e=this.da.uh+Math.cos(Lb(e))*c;this.M.dispatchEvent(new N("onclickonroad"));this.M.ra(this.Qd.oh(new H(d,e)),{Sl:o});return c},iz:function(a){var b=this.Fn;a&&(b=this.Mq(a));if(!b)return 300;var c=this.da.links[this.ib].wh,d=Math.sin(Lb(c)),e=Math.cos(Lb(c)),a=Math.sin(Lb(-c)),c=Math.cos(Lb(-c)),f=e*b[0]+d*b[2],d=-d*b[0]+e*b[2];70<d&&(d=70);-70>d&&(d=-70);b[0]=c*f+a*d;b[2]=-a*f+c*d;this.Fn[0]=b[0];this.Fn[2]=b[2];b=f/9;return 300<b? 300:b},hR:function(a){for(var b=360,c=-1,d=0;d<this.da.links.length;d++){var e=Math.abs(a-this.da.links[d].dir);e<b&&(b=e,c=d)}d=c==this.da.links.length-1?0:c+1;e=this.da.links[d].dir;if(e<this.da.links[c].dir&&(e=Math.abs(a-(e+360)),e<b))return d;d=0==c?this.da.links.length-1:c-1;e=this.da.links[d].dir;return e>this.da.links[c].dir&&(e=Math.abs(360+a-e),e<b)?d:c},XP:function(a,b){return Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[2]-b[2],2))},Pz:function(){var a=this.ge,b=this.eb;a.mt=b.getUniformLocation(a, "uPMatrix");a.jt=b.getUniformLocation(a,"uMVMatrix");a.alpha=b.getUniformLocation(a,"uAlpha");a.color=b.getUniformLocation(a,"uColor");a=this.Wu;a.mt=b.getUniformLocation(a,"uPMatrix");a.jt=b.getUniformLocation(a,"uMVMatrix");a.eZ=b.getUniformLocation(a,"uSampler")},Qz:function(){var a=this.ge,b=this.eb;a.kn=b.getAttribLocation(a,"aVertexPosition");a=this.Wu;a.kn=b.getAttribLocation(a,"aVertexPosition");a.gu=b.getAttribLocation(a,"aVertexTextureCoord")},fB:function(){var a=this.ge,b=this.eb;b.uniformMatrix4fv(a.mt, q,this.Qh);b.uniformMatrix4fv(a.jt,q,this.GA)},ta:s(),setData:function(a){if(this.da=a)this.Nd={},this.JQ=this.da.tiles.dirNorth,this.Oa=o},rv:function(a,b,c,d){this.eb&&(this.Oa&&this.da)&&(this.eb.useProgram(this.ge),this.Qh=a,this.GA=b,this.hr=c,this.NS=d,this.fB(),this.vb())},vb:function(){if(this.Qh&&this.GA){var a=this.iT(),b=this.eb,c=this.ge,d=this.Wu;b.depthMask(q);b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA);var e=this.Sv;e.VD();e.Go(c.kn);e.zC();this.Fl&&(c=0.6,5>this.MG&&(c=0.2),this.Eq(this.GG.tc, this.GG.uD(),this.Fn,1,c,q),this.Eq(this.zI.tc,this.zI.uD(),this.Fn,1,c+0.3,q));if(!(this.zH||this.Qj===q)){var c=a[0],f=a[1],g=a[2],i=a[3],k=a[4],l=a[5],a=a[6];b.blendFuncSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA);b.activeTexture(b.TEXTURE2);b.useProgram(d);e.VD();e.Go(d.kn);e.Go(d.gu);e.zC();b.uniformMatrix4fv(d.mt,q,this.Qh);b.uniformMatrix4fv(d.jt,q,this.GA);b.uniform1i(d.eZ,2);this.zn&&(b.bindTexture(b.TEXTURE_2D,this.zn),this.Eq(c,i,p,1,1,o,k));this.Bn&&(b.bindTexture(b.TEXTURE_2D, this.Bn),this.Eq(f,i,p,1,1,o,k));this.An&&(b.bindTexture(b.TEXTURE_2D,this.An),this.Eq(g,l,p,1,1,o,a));b.depthMask(o)}}},iT:function(){for(var a=[],b=[],c=[],d=[],e=[],f=Ui.length/3,g=this.M.Ca().heading+this.JQ;0>g;)g+=360;var i=this.M.Ca().pitch,g=20,k=-30,l=this.fo.Wi||this.M.ea(),g=g+20*l;0>i&&(i=Math.abs(i),g*=(90-i)/90,k-=20*i/90);for(i=0;i<this.da.links.length;i++){var m=this.da.links[i],n=Math.cos(Lb(m.wh))*g,u=Math.sin(Lb(m.wh))*g,l=qi.create();qi.zm(l);qi.rotate(l,l,Lb(m.wh-90),[0,1,0]); for(var m=[n,k,u],n=Ui,u=Wi,v=0;v<f;v++){var x=this.CG(l,n,3*v);a.push(x[0]+m[0],m[1]-1,x[2]+m[2]);b.push(x[0]+m[0],m[1],x[2]+m[2]);x=this.CG(l,u,3*v);c.push(x[0]+m[0],m[1],x[2]+m[2])}}f=this.VP(d,[],e,[]);return this.wS=a=[a,b,c,d,f[0],e,f[1]]},VP:function(a,b,c,d){for(var e=0;e<this.da.links.length;e++){var f=4*e;a.push(f,f+1,f+2);a.push(f,f+2,f+3);c.push(f,f+1,f+3);c.push(f+2,f+3,f+1);b=b.concat(Vi);d=d.concat(this.zR(this.da.links[e].dir))}return[b,d]},CG:function(a,b,c){return[a[0]*b[c]+a[1]* b[c+1]+a[2]*b[c+2],0,a[8]*b[c]+a[9]*b[c+1]+a[10]*b[c+2]]},Eq:function(a,b,c,d,e,f,g){var i=this.eb,k=this.ge;f&&(k=this.Wu);var l=[0,0,0],m=[];if(c){l[0]=c[0];l[2]=c[2];for(var n=0;n<a.length/3;n++){var u=3*n;m.push(a[u]+l[0],c[1],a[u+2]+l[2])}}else m=a;f?(this.Kl||(this.Kl=i.createBuffer()),i.bindBuffer(i.ARRAY_BUFFER,this.Kl),i.bufferData(i.ARRAY_BUFFER,new Float32Array(g),i.STATIC_DRAW),i.vertexAttribPointer(k.gu,2,i.FLOAT,q,0,0)):(i.uniform1f(k.color,d),i.uniform1f(k.alpha,e));this.PH||(this.PH= i.createBuffer());i.bindBuffer(i.ARRAY_BUFFER,this.PH);i.bufferData(i.ARRAY_BUFFER,new Float32Array(m),i.STATIC_DRAW);this.cv||(this.cv=i.createBuffer());i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this.cv);i.bufferData(i.ELEMENT_ARRAY_BUFFER,new Uint16Array(b),i.STATIC_DRAW);this.cv.DF=b.length;i.vertexAttribPointer(k.kn,3,i.FLOAT,q,0,0);i.drawElements(i.TRIANGLES,this.cv.DF,i.UNSIGNED_SHORT,0)},Mq:function(a,b){var c=this.hr,d=this.NS;if(c){var e=a[0],f=a[1],g=this.Xi,i=this.Oj,k=Y.create(),e=Y.rg(2*e/ g-1,1-2*f/i,-1,1);qi.multiply(k,c,e);qi.multiply(k,d,k);c=200*k[0];d=200*k[1];k=200*k[2];e=(b||-20)/d;if(!(0>e))return[c*e,d*e,k*e]}},Dk:function(){this.Xi=this.Va.width;this.Oj=this.Va.height},zR:function(a){var b=Math.ceil(Math.floor((a+360)%360/22.5)/2);8===b&&(b=0);for(var a=Xi.slice(0),c=Math.floor(b/2),b=b%2,d=0;d<a.length;d++)a[d]=0==d%2?a[d]+0.25*c:a[d]+0.5*b;return a},hV:function(){this.Nd={}},show:function(){this.Qj=o},R:function(){this.Qj=q},RC:function(){this.Mn=o},wC:function(){this.Mn= q},rC:function(){this.hV();var a=this.eb;a.deleteTexture(this.zn);a.deleteTexture(this.Bn);a.deleteTexture(this.An);this.An=this.Bn=this.zn=p}}); ');
