_jsload2&&_jsload2('buslinesearch', 'w.extend(Ed.prototype,{Md:function(){for(var a=0,b=this.Na.length;a<b;a++){var c=this.Na[a];this[c.method].apply(this,c.arguments)}delete this.Na},Su:function(a,b,c){a=Q.wb(a);return z.kp+"?c="+a.lng+","+a.lat+"&i="+b+","+encodeURIComponent(c)+"&s="+encodeURIComponent("tpl:LinesQuery")},getBusList:function(a){var b=this;this.Jg(this.ud,function(c){c?$c.$a(function(a,c){b.RP(a,c)},{qt:b.eP,c:c,wd:a},{rb:a}):(this.rc=new Mh({rb:a,city:"",oi:"",Eh:""}),b.qb(5),b.Qa(W.ku,this.rc))})},RP:function(a,b){this.clearResults(); var c=a.result;if(!a.content||0!=c.error||c.type!=this.gP)this.rc=new Mh({rb:b.rb,city:a.current_city.name,oi:"",Eh:a.current_city.code}),this.qb(7),this.Qa(W.ku,this.rc);else{for(var c=a.content,d=[],e=0,f=c.length;e<f;e++)d.push({name:c[e].name,dk:c[e].uid,Eh:a.current_city.code,Pj:e,uA:b.rb,Qi:c[e].poiType||2});this.rc=new Mh({rb:b.rb,city:a.current_city.name,oi:this.Su(O.sb(a.current_city.geo,o).point,a.current_city.code,b.rb),hM:d,Eh:a.current_city.code});this.qb(0);this.Qa(W.ku,this.rc);this.rT(); this.rS(a.current_city.geo,a.current_city.level,a.current_city.code)}},rT:function(){if(this.k.ja.Fa&&this.k.ja.Fa.appendChild&&this.rc&&0<this.rc.Ks()){var a=L("div",{style:"font:12px "+E.fontFamily+";background:#fff"});a.id="divResult"+this.aa;for(var b=this.rc.Ks(),c=[],d=0;d<b;d++){var e=this.rc.pD(d).name;c.push(\'<dl style="margin:3px 3px"><dt><span style="cursor:pointer" onclick=Instance(\\\'\'+this.aa+"\')._selectBusListItem("+d+")><img id=imgBLIcon"+d+" src="+Ed.av+\' style="border:none" /></span>&nbsp;&nbsp;<a style="color:blue" href="javascript:void(0)" onclick=Instance(\\\'\'+ this.aa+"\')._selectBusListItem("+d+")>"+e+"</a></dt><dd id=ddBLInfo"+d+\' style="display:none;margin:2px 0px"></dd></dl>\')}b="";this.rc.moreResultsUrl&&(b=b+"<div style=\'color:#7777cc;background:#e5ecf9;overflow:hidden;padding:2px;text-align:right\'>"+("<a style=\'color:#7777cc\' href=\'"+this.rc.moreResultsUrl+"\' target=\'_blank\'>\\u5230\\u767e\\u5ea6\\u5730\\u56fe\\u67e5\\u770b&#187;</a>"),b+="&nbsp;</div>");a.innerHTML=c.join("")+b;this.k.ja.Fa.appendChild(a);this.Qa(W.RF,a)}},rS:function(a,b,c){var d=this.k.ja.map; d&&(a=O.sb(a,o).point,this.RA?this.RA!=c&&(d.zd(a,b),this.RA=c):(d.zd(a,b),this.RA=c))},eU:function(a){if(this.rc)for(var b=0,c=this.rc.Ks();b<c;b++){var d=w.Bc("ddBLInfo"+b),e=w.Bc("imgBLIcon"+b);b==a?"none"==d.style.display?(d.style.display="block",e.src=Ed.jS):(d.style.display="none",e.src=Ed.av):(d.style.display="none",e.src=Ed.av)}},_selectBusListItem:function(a,b){if(!b){var c=w.Bc("ddBLInfo"+a),d=w.Bc("imgBLIcon"+a);if("block"==c.style.display){c.style.display="none";d.src=Ed.av;return}}if(this.rc&& this.rc[a]&&0<this.rc[a].Ro())this.Cc=this.rc[a],this.qb(0),this.Qa(W.ju,this.Cc),this.tI(a),this.sI(a);else{var e=this,c=this.rc.pD(a);$c.$a(function(b,c){e.QP(b,c,a)},{qt:e.dP,c:c.Eh,uid:c.dk},{name:c.name,Qi:c.Qi})}},clearResults:function(){delete this.rc;delete this.Cc;delete this.Ui;delete this.A0;this.Hj();this.k.ja.Fa&&(this.k.ja.Fa.innerHTML="")},getBusLine:function(a){a&&("object"==typeof a&&a.dk&&""!=a.dk&&"undefined"!=typeof a.Eh&&""!=a.Eh.toString()&&"undefined"!=typeof a.Pj&&""!=a.Pj.toString()&& "undefined"!=typeof a.uA&&""!=a.uA.toString())&&(this.rc&&0<this.rc.Ks()&&a.Eh==this.rc.Eh&&a.uA==this.rc.keyword)&&this._selectBusListItem(a.Pj,o)},QP:function(a,b,c){var d=a.result;if(!a.content||!a.content[0]||0!=d.error||d.type!=this.fP)this.Cc=new Nh({name:b.name}),this.qb(7),this.Qa(W.ju,this.Cc);else{var a=a.content[0],e=d="",f="",g={},i=[],d=a.startTime,e=a.endTime,f=a.company;a.geo&&(g=O.sb(a.geo,o),g=new Ac(g.ha));if(a.stations)for(var k=0,l=a.stations.length;k<l;k++)if(a.stations[k].geo){var m= O.sb(a.stations[k].geo,o);i.push({name:a.stations[k].name,position:m.point,dk:a.stations[k].uid})}this.Cc=new Nh({name:b.name,startTime:d,gW:e,lV:f,OY:g,SN:i,Qi:b.Qi});this.qb(0);this.Qa(W.ju,this.Cc);this.rc[c]=this.Cc;this.tI(c);this.sI(c)}},tI:function(a){if(this.k.ja.Fa&&this.k.ja.Fa.appendChild&&this.Cc&&0<this.Cc.Ro()){this.eU(a);var b=w.Bc("ddBLInfo"+a);if(b){var c=[];c.push(\'<table style="width:100%;background:#CDCDCD;font:12px \'+E.fontFamily+\'" cellspacing="1" cellpadding="1" ><tbody>\'); c.push(\'<tr><td style="width:95px;line-height:22px;padding:0px 8px;text-align:left;vertical-align:top;background:#F4F4F4" >\\u9996\\u672b\\u8f66\\u65f6\\u95f4</th><td  style="background:#FFFFFF;line-height:22px;padding:0px 8px" >\'+this.Cc.startTime+"-"+this.Cc.endTime+"</td></tr>");c.push(\'<tr><td style="width:95px;line-height:22px;padding:0px 8px;text-align:left;vertical-align:top;background:#F4F4F4" >\\u6240\\u5c5e\\u516c\\u53f8</th><td  style="background:#FFFFFF;line-height:22px;padding:0px 8px" >\'+this.Cc.company+ "</td></tr>");c.push("</tbody></table>");4==this.Cc.Qi?c.push(\'<p style="margin:2px 0px;font:12px \'+E.fontFamily+\';">\\u6cbf\\u7ebf\\u5730\\u94c1\\u7ad9:</p>\'):c.push(\'<p style="margin:2px 0px;font:12px \'+E.fontFamily+\';">\\u6cbf\\u7ebf\\u516c\\u4ea4\\u7ad9\\u70b9:</p>\');c.push(\'<table style="width:100%;font:12px \'+E.fontFamily+\';" ><tbody>\');for(var d=0,e=this.Cc.Ro();d<e;d++)c.push(\'<tr><td style="width:20px">\'+(d+1)+"</th><td><a id=aStop_"+a+"_"+d+\' style="color:blue" href="javascript:void(0)" onclick=Instance(\\\'\'+ this.aa+"\')._selectBusStop("+a+","+d+")>"+this.Cc.Rw(d).name+"</a></td></tr>");c.push("</tbody></table>");b.innerHTML=c.join("")}a=w.Bc("divResult"+this.aa);this.Qa(W.QF,a)}},sI:function(a){if(this.k.ja.map&&this.Cc&&0<this.Cc.Ro()){this.Hj();V.Ml(this.k.ja.map,this.Cc.ne());var b=this.Cc.Uo();this.Qa(W.lu,b);var c=this;this.Ui=[];for(var d=0,e=this.Cc.Ro();d<e;d++){var f=this.Cc.Rw(d).position,g=this.Cc.Rw(d).name,f=V.AU(this.k.ja.map,f,g);(function(b,d,e){b.addEventListener("click",function(f){var g= ["<div style=\'font:12px "+E.fontFamily+"\'>"];g.push("<div style=\'margin:10px 1em 24px 0\'><b>"+d+"</b></div>");g.push("</div>");var u=new qc(g.join(""),{title:"",height:0,width:220,margin:[10,10,20,10]});u.addEventListener("open",function(){var b=w.Bc("aStop_"+a+"_"+e);b&&(b.style.backgroundColor="#cccccc")});u.addEventListener("close",function(){var b=w.Bc("aStop_"+a+"_"+e);b&&(b.style.backgroundColor="#ffffff")});g=c.k.ja.map;g.D.hm?Wd.dp(u,g.getCurrentCity().code,{panoInstance:g.M,lngLat:f.target.ga(), titleTip:d,type:"busline"},function(){b.Kb(u)}):b.Kb(u)})})(f,g,d);f.mB=g;this.Ui.push(f)}this.Qa(W.Rp,this.Ui);this.k.ja.Xg&&this.k.ja.map.zh(b.ne(),{margins:[5,5,5,5]})}},_selectBusStop:function(a,b){if(this.k.ja.map&&this.Ui&&0<this.Ui.length){var c=this.Ui[b];if(c.mB){var d=["<div style=\'font:12px "+E.fontFamily+"\'>"];d.push("<div style=\'margin:10px 1em 24px 0\'><b>"+c.mB+"</b></div>");d.push("</div>");var e=new qc(d.join(""),{title:"",height:0,width:220,margin:[10,10,20,10]});e.addEventListener("open", function(){var c=w.Bc("aStop_"+a+"_"+b);c&&(c.style.backgroundColor="#cccccc")});e.addEventListener("close",function(){var c=w.Bc("aStop_"+a+"_"+b);c&&(c.style.backgroundColor="#ffffff")});d=this.k.ja.map;d.D.hm?Wd.dp(e,d.getCurrentCity().code,{panoInstance:d.M,lngLat:c.ga(),titleTip:c.mB,type:"busline"},function(){c.Kb(e)}):c.Kb(e)}}else{this.dN&&(this.dN.style.backgroundColor="#ffffff");if(d=w.Bc("aStop_"+a+"_"+b))d.style.backgroundColor="#cccccc";this.dN=d}},Hj:function(){this.k.ja.map&&this.k.ja.map.SJ()}, qb:function(a){"number"==typeof a?this.yd=a:delete this.yd}});function Mh(a){this.keyword=a.rb||"";this.city=a.city;this.moreResultsUrl=a.oi;this.yA=a.hM&&a.hM.slice(0)||[];this.Eh=a.Eh}w.extend(Mh.prototype,{pD:function(a){if(this.yA[a])return this.yA[a]},Ks:function(){return this.yA.length}});var Oh=Mh.prototype;T(Oh,{getNumBusList:Oh.Ks,getBusListItem:Oh.pD});function Nh(a){this.name=a.name||"";this.startTime=a.startTime||"";this.endTime=a.gW||"";this.company=a.lV||"";this.Ri=a.OY||{};this.oB=a.SN&&a.SN.slice(0)||[];this.Qi=a.Qi||2}w.extend(Nh.prototype,{Rw:function(a){if(this.oB[a])return this.oB[a]},Ro:function(){return this.oB.length},Uo:t("Ri"),ne:function(){if(this.Ri.ne())return this.Ri.ne()}});var Ph=Nh.prototype;T(Ph,{getNumBusStations:Ph.Ro,getBusStation:Ph.Rw,getPath:Ph.ne,getPolyline:Ph.Uo}); ');
